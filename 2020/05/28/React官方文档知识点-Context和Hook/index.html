<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="Sharing Knowledge And Learn More">
  <meta name="author" content="Toulon Du">
  <meta name="keywords" content="">
  <title>Reactå®˜æ–¹æ–‡æ¡£çŸ¥è¯†ç‚¹-Contextå’ŒHook - Toulon&#39;s BLOG</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_fmb4a04yx8h.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">




<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Toulon's Secret</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">
              <i class="iconfont icon-home-fill"></i>
              é¦–é¡µ</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">
              <i class="iconfont icon-archive-fill"></i>
              å½’æ¡£</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">
              <i class="iconfont icon-category-fill"></i>
              ç›®å½•</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">
              <i class="iconfont icon-tags-fill"></i>
              æ ‡ç­¾</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">
              <i class="iconfont icon-user-fill"></i>
              å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <div class="mt-3 post-meta">
                  <i class="iconfont icon-date-fill" aria-hidden="true"></i>
                  <time datetime="2020-05-28 17:56">
                    2020å¹´5æœˆ28æ—¥ ä¸‹åˆ
                  </time>
                </div>
              

              <div class="mt-1">
                
                  
                  <span class="post-meta mr-2">
                    <i class="iconfont icon-chart"></i>
                    11.3k å­—
                  </span>
                

                
                  
                  <span class="post-meta mr-2">
                      <i class="iconfont icon-clock-fill"></i>
                    
                    
                    145
                     åˆ†é’Ÿ
                  </span>
                

                
              </div>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <p>ä¹‹å‰çš„è¿›é˜¶ä¸­å…¶å®æœ‰Contextçš„å†…å®¹ï¼Œä¸è¿‡é‚£é‡Œè·³è¿‡äº†ï¼Œä½†Hookçš„ä¸€äº›APIæ¶‰åŠåˆ°Contextçš„æ“ä½œã€‚æ‰€ä»¥å…ˆç†Ÿæ‚‰ä¸€ä¸‹Contextçš„å†…å®¹ã€‚<br>Hookç®—æ˜¯Reactä¸­æ¯”è¾ƒæ–°çš„ä¸€ä¸ªç‰¹æ€§ï¼Œé…åˆContextï¼Œè¿™è®©æˆ‘ä»¬åœ¨ç®¡ç†çŠ¶æ€çš„æ—¶å€™æ›´åŠ çš„æ–¹ä¾¿ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¦‚æœä½ çš„åº”ç”¨ä¸æ˜¯é‚£ä¹ˆå¤æ‚ï¼Œä½ ç”šè‡³å¯ä»¥æ”¾ä¸‹reduxã€‚å½“ç„¶è¿™ä¸€ç‚¹æ¯”è¾ƒè§ä»è§æ™ºã€‚</p>
<h1 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h1><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><pre><code class="hljs plain">&#x2F;&#x2F; Context å¯ä»¥è®©æˆ‘ä»¬æ— é¡»æ˜ç¡®åœ°ä¼ éæ¯ä¸€ä¸ªç»„ä»¶ï¼Œå°±èƒ½å°†å€¼æ·±å…¥ä¼ é€’è¿›ç»„ä»¶æ ‘ã€‚
&#x2F;&#x2F; ä¸ºå½“å‰çš„ theme åˆ›å»ºä¸€ä¸ª contextï¼ˆâ€œlightâ€ä¸ºé»˜è®¤å€¼ï¼‰ã€‚
const ThemeContext &#x3D; React.createContext(&#39;light&#39;);
class App extends React.Component &#123;
  render() &#123;
    &#x2F;&#x2F; ä½¿ç”¨ä¸€ä¸ª Provider æ¥å°†å½“å‰çš„ theme ä¼ é€’ç»™ä»¥ä¸‹çš„ç»„ä»¶æ ‘ã€‚
    &#x2F;&#x2F; æ— è®ºå¤šæ·±ï¼Œä»»ä½•ç»„ä»¶éƒ½èƒ½è¯»å–è¿™ä¸ªå€¼ã€‚
    &#x2F;&#x2F; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°† â€œdarkâ€ ä½œä¸ºå½“å‰çš„å€¼ä¼ é€’ä¸‹å»ã€‚
    return (
      &lt;ThemeContext.Provider value&#x3D;&quot;dark&quot;&gt;
        &lt;Toolbar &#x2F;&gt;
      &lt;&#x2F;ThemeContext.Provider&gt;
    );
  &#125;
&#125;

&#x2F;&#x2F; ä¸­é—´çš„ç»„ä»¶å†ä¹Ÿä¸å¿…æŒ‡æ˜å¾€ä¸‹ä¼ é€’ theme äº†ã€‚
function Toolbar() &#123;
  return (
    &lt;div&gt;
      &lt;ThemedButton &#x2F;&gt;
    &lt;&#x2F;div&gt;
  );
&#125;

class ThemedButton extends React.Component &#123;
  &#x2F;&#x2F; æŒ‡å®š contextType è¯»å–å½“å‰çš„ theme contextã€‚
  &#x2F;&#x2F; React ä¼šå¾€ä¸Šæ‰¾åˆ°æœ€è¿‘çš„ theme Providerï¼Œç„¶åä½¿ç”¨å®ƒçš„å€¼ã€‚
  &#x2F;&#x2F; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“å‰çš„ theme å€¼ä¸º â€œdarkâ€ã€‚
  static contextType &#x3D; ThemeContext;
  render() &#123;
    return &lt;Button theme&#x3D;&#123;this.context&#125; &#x2F;&gt;;
  &#125;
&#125;</code></pre>

<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="React-createContext"><a href="#React-createContext" class="headerlink" title="React.createContext"></a>React.createContext</h3><pre><code class="hljs plain">const MyContext &#x3D; React.createContext(defaultValue);</code></pre>
<p>åˆ›å»ºä¸€ä¸ª Context å¯¹è±¡ã€‚å½“ React æ¸²æŸ“ä¸€ä¸ªè®¢é˜…äº†è¿™ä¸ª Context å¯¹è±¡çš„ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¼šä»ç»„ä»¶æ ‘ä¸­ç¦»è‡ªèº«æœ€è¿‘çš„é‚£ä¸ªåŒ¹é…çš„ Provider ä¸­è¯»å–åˆ°å½“å‰çš„ context å€¼ã€‚</p>
<p>åªæœ‰å½“ç»„ä»¶æ‰€å¤„çš„æ ‘ä¸­æ²¡æœ‰åŒ¹é…åˆ° Provider æ—¶ï¼Œå…¶ defaultValue å‚æ•°æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<h3 id="Context-Provider"><a href="#Context-Provider" class="headerlink" title="Context.Provider"></a>Context.Provider</h3><pre><code class="hljs plain">&lt;MyContext.Provider value&#x3D;&#123;&#x2F;* æŸä¸ªå€¼ *&#x2F;&#125;&gt;</code></pre>
<p>æ¯ä¸ª Context å¯¹è±¡éƒ½ä¼šè¿”å›ä¸€ä¸ª Provider React ç»„ä»¶ï¼Œå®ƒå…è®¸æ¶ˆè´¹ç»„ä»¶è®¢é˜… context çš„å˜åŒ–ã€‚</p>
<p>Provider æ¥æ”¶ä¸€ä¸ª value å±æ€§ï¼Œä¼ é€’ç»™æ¶ˆè´¹ç»„ä»¶ã€‚ä¸€ä¸ª Provider å¯ä»¥å’Œå¤šä¸ªæ¶ˆè´¹ç»„ä»¶æœ‰å¯¹åº”å…³ç³»ã€‚å¤šä¸ª Provider ä¹Ÿå¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œé‡Œå±‚çš„ä¼šè¦†ç›–å¤–å±‚çš„æ•°æ®ã€‚</p>
<p>å½“ Provider çš„ value å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå†…éƒ¨çš„æ‰€æœ‰æ¶ˆè´¹ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚Provider åŠå…¶å†…éƒ¨ consumer ç»„ä»¶éƒ½ä¸å—åˆ¶äº shouldComponentUpdate å‡½æ•°ï¼Œå› æ­¤å½“ consumer ç»„ä»¶åœ¨å…¶ç¥–å…ˆç»„ä»¶é€€å‡ºæ›´æ–°çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ›´æ–°ã€‚</p>
<p>é€šè¿‡æ–°æ—§å€¼æ£€æµ‹æ¥ç¡®å®šå˜åŒ–ï¼Œä½¿ç”¨äº†ä¸ Object.is ç›¸åŒçš„ç®—æ³•ã€‚</p>
<h3 id="Class-contextType"><a href="#Class-contextType" class="headerlink" title="Class.contextType"></a>Class.contextType</h3><pre><code class="hljs plain">class MyClass extends React.Component &#123;
  componentDidMount() &#123;
    let value &#x3D; this.context;
    &#x2F;* åœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåï¼Œä½¿ç”¨ MyContext ç»„ä»¶çš„å€¼æ¥æ‰§è¡Œä¸€äº›æœ‰å‰¯ä½œç”¨çš„æ“ä½œ *&#x2F;
  &#125;
  componentDidUpdate() &#123;
    let value &#x3D; this.context;
    &#x2F;* ... *&#x2F;
  &#125;
  componentWillUnmount() &#123;
    let value &#x3D; this.context;
    &#x2F;* ... *&#x2F;
  &#125;
  render() &#123;
    let value &#x3D; this.context;
    &#x2F;* åŸºäº MyContext ç»„ä»¶çš„å€¼è¿›è¡Œæ¸²æŸ“ *&#x2F;
  &#125;
&#125;
MyClass.contextType &#x3D; MyContext;</code></pre>
<p>æŒ‚è½½åœ¨ class ä¸Šçš„ contextType å±æ€§ä¼šè¢«é‡èµ‹å€¼ä¸ºä¸€ä¸ªç”± React.createContext() åˆ›å»ºçš„ Context å¯¹è±¡ã€‚è¿™èƒ½è®©ä½ ä½¿ç”¨ this.context æ¥æ¶ˆè´¹æœ€è¿‘ Context ä¸Šçš„é‚£ä¸ªå€¼ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•ç”Ÿå‘½å‘¨æœŸä¸­è®¿é—®åˆ°å®ƒï¼ŒåŒ…æ‹¬ render å‡½æ•°ä¸­ã€‚</p>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨å®éªŒæ€§çš„ public class fields è¯­æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨ static è¿™ä¸ªç±»å±æ€§æ¥åˆå§‹åŒ–ä½ çš„ contextTypeã€‚</p>
<pre><code class="hljs plain">class MyClass extends React.Component &#123;
  static contextType &#x3D; MyContext;
  render() &#123;
    let value &#x3D; this.context;
    &#x2F;* åŸºäºè¿™ä¸ªå€¼è¿›è¡Œæ¸²æŸ“å·¥ä½œ *&#x2F;
  &#125;
&#125;</code></pre>

<p>å¦‚æœæ˜¯å‡½æ•°å¼ç»„ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼š</p>
<pre><code class="hljs plain">&lt;MyContext.Consumer&gt;
  &#123;value &#x3D;&gt; &#x2F;* åŸºäº context å€¼è¿›è¡Œæ¸²æŸ“*&#x2F;&#125;
&lt;&#x2F;MyContext.Consumer&gt;</code></pre>


<h2 id="æ›´å¤æ‚çš„æƒ…å½¢"><a href="#æ›´å¤æ‚çš„æƒ…å½¢" class="headerlink" title="æ›´å¤æ‚çš„æƒ…å½¢"></a>æ›´å¤æ‚çš„æƒ…å½¢</h2><h3 id="åŠ¨æ€Context"><a href="#åŠ¨æ€Context" class="headerlink" title="åŠ¨æ€Context"></a>åŠ¨æ€Context</h3><p>å¯¹äºä¸Šé¢çš„ theme ä¾‹å­ï¼Œä½¿ç”¨åŠ¨æ€å€¼ï¼ˆdynamic valuesï¼‰åæ›´å¤æ‚çš„ç”¨æ³•ï¼š<br><strong>theme-context.js</strong></p>
<pre><code class="hljs plain">import React from &#39;react&#39;;

export const themes &#x3D; &#123;
    light: &#123;
      foreground: &#39;#000000&#39;,
      background: &#39;#eeeeee&#39;,
    &#125;,
    dark: &#123;
      foreground: &#39;#ffffff&#39;,
      background: &#39;#222222&#39;,
    &#125;,
  &#125;;
  
  export const ThemeContext &#x3D; React.createContext(
    themes.dark &#x2F;&#x2F; é»˜è®¤å€¼
  );</code></pre>
<p><strong>themedButton.js</strong></p>
<pre><code class="hljs plain">import React,&#123;Component&#125; from &#39;react&#39;
import &#123;ThemeContext&#125; from &#39;.&#x2F;theme-context&#39;;

class ThemedButton extends React.Component &#123;
  render() &#123;
    let props &#x3D; this.props;
    let theme &#x3D; this.context;
    return (
      &lt;button
        &#123;...props&#125;
        style&#x3D;&#123;&#123;backgroundColor: theme.background&#125;&#125;
      &#x2F;&gt;
    );
  &#125;
&#125;
ThemedButton.contextType &#x3D; ThemeContext;

export default ThemedButton;</code></pre>
<p><strong>App.js</strong></p>
<pre><code class="hljs plain">&#x2F;&#x2F; ä¸€ä¸ªä½¿ç”¨ ThemedButton çš„ä¸­é—´ç»„ä»¶
function Toolbar(props) &#123;
  return (
    &lt;ThemedButton onClick&#x3D;&#123;props.changeTheme&#125;&gt;
      Change Theme
    &lt;&#x2F;ThemedButton&gt;
  );
&#125;

export default class App extends React.Component &#123;
  constructor(props) &#123;
    super(props);
    this.state &#x3D; &#123;
      theme: themes.light,
    &#125;;

    this.toggleTheme &#x3D; () &#x3D;&gt; &#123;
      this.setState(state &#x3D;&gt; (&#123;
        theme:
          state.theme &#x3D;&#x3D;&#x3D; themes.dark
            ? themes.light
            : themes.dark,
      &#125;));
    &#125;;
  &#125;

  render() &#123;
    &#x2F;&#x2F; åœ¨ ThemeProvider å†…éƒ¨çš„ ThemedButton æŒ‰é’®ç»„ä»¶ä½¿ç”¨ state ä¸­çš„ theme å€¼ï¼Œ
    &#x2F;&#x2F; è€Œå¤–éƒ¨çš„ç»„ä»¶ä½¿ç”¨é»˜è®¤çš„ theme å€¼
    return (
      &lt;&gt;
        &lt;ThemeContext.Provider value&#x3D;&#123;this.state.theme&#125;&gt;
          &lt;Toolbar changeTheme&#x3D;&#123;this.toggleTheme&#125; &#x2F;&gt;
        &lt;&#x2F;ThemeContext.Provider&gt;
        &lt;div&gt;
          &lt;ThemedButton &#x2F;&gt;
        &lt;&#x2F;div&gt;
      &lt;&#x2F;&gt;
    );
  &#125;
&#125;</code></pre>

<h3 id="åœ¨åµŒå¥—ç»„ä»¶ä¸­æ›´æ–°Context"><a href="#åœ¨åµŒå¥—ç»„ä»¶ä¸­æ›´æ–°Context" class="headerlink" title="åœ¨åµŒå¥—ç»„ä»¶ä¸­æ›´æ–°Context"></a>åœ¨åµŒå¥—ç»„ä»¶ä¸­æ›´æ–°Context</h3><p>ä»ä¸€ä¸ªåœ¨ç»„ä»¶æ ‘ä¸­åµŒå¥—å¾ˆæ·±çš„ç»„ä»¶ä¸­æ›´æ–° context æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡ context ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œä½¿å¾— consumers ç»„ä»¶æ›´æ–° contextã€‚å®é™…å°±æ˜¯å°†æŸä¸ªé«˜å±‚ç»„ä»¶çš„æŸä¸ªæ·±å±‚ç»„ä»¶è¦ç”¨åˆ°çš„stateå’Œæ§åˆ¶stateå˜åŒ–çš„å‡½æ•°ä½œä¸ºcontextï¼Œç„¶åä¸éœ€è¦ä¸€å±‚ä¸€å±‚ä¼ é€’ï¼Œåº•å±‚ç»„ä»¶é€šè¿‡Consumeræ¥è·å–</p>
<p><strong>theme-context.js</strong></p>
<pre><code class="hljs plain">&#x2F;&#x2F; ç¡®ä¿ä¼ é€’ç»™ createContext çš„é»˜è®¤å€¼æ•°æ®ç»“æ„æ˜¯è°ƒç”¨çš„ç»„ä»¶ï¼ˆconsumersï¼‰æ‰€èƒ½åŒ¹é…çš„ï¼
export const ThemeContext &#x3D; React.createContext(&#123;
  theme: themes.dark,
  toggleTheme: () &#x3D;&gt; &#123;&#125;,
&#125;);</code></pre>

<p><strong>theme-toggler-button.js</strong></p>
<pre><code class="hljs plain">import &#123;ThemeContext&#125; from &#39;.&#x2F;theme-context&#39;;

function ThemeTogglerButton() &#123;
  &#x2F;&#x2F; Theme Toggler æŒ‰é’®ä¸ä»…ä»…åªè·å– theme å€¼ï¼Œå®ƒä¹Ÿä» context ä¸­è·å–åˆ°ä¸€ä¸ª toggleTheme å‡½æ•°
  return (
    &lt;ThemeContext.Consumer&gt;
      &#123;(&#123;theme, toggleTheme&#125;) &#x3D;&gt; (
        &lt;button          onClick&#x3D;&#123;toggleTheme&#125;
          style&#x3D;&#123;&#123;backgroundColor: theme.background&#125;&#125;&gt;

          Toggle Theme
        &lt;&#x2F;button&gt;
      )&#125;
    &lt;&#x2F;ThemeContext.Consumer&gt;
  );
&#125;

export default ThemeTogglerButton;</code></pre>

<p><strong>app.js</strong></p>
<pre><code class="hljs plain">import &#123;ThemeContext, themes&#125; from &#39;.&#x2F;theme-context&#39;;
import ThemeTogglerButton from &#39;.&#x2F;theme-toggler-button&#39;;

class App extends React.Component &#123;
  constructor(props) &#123;
    super(props);

    this.toggleTheme &#x3D; () &#x3D;&gt; &#123;
      this.setState(state &#x3D;&gt; (&#123;
        theme:
          state.theme &#x3D;&#x3D;&#x3D; themes.dark
            ? themes.light
            : themes.dark,
      &#125;));
    &#125;;

    &#x2F;&#x2F; State ä¹ŸåŒ…å«äº†æ›´æ–°å‡½æ•°ï¼Œå› æ­¤å®ƒä¼šè¢«ä¼ é€’è¿› context providerã€‚
    this.state &#x3D; &#123;
      theme: themes.light,
      toggleTheme: this.toggleTheme,
    &#125;;
  &#125;

  render() &#123;
    &#x2F;&#x2F; æ•´ä¸ª state éƒ½è¢«ä¼ é€’è¿› provider
    return (
      &lt;ThemeContext.Provider value&#x3D;&#123;this.state&#125;&gt;
        &lt;Content &#x2F;&gt;
      &lt;&#x2F;ThemeContext.Provider&gt;
    );
  &#125;
&#125;

function Content() &#123;
  return (
    &lt;div&gt;
      &lt;ThemeTogglerButton &#x2F;&gt;
    &lt;&#x2F;div&gt;
  );
&#125;

ReactDOM.render(&lt;App &#x2F;&gt;, document.root);</code></pre>

<h3 id="æ¶ˆè´¹å¤šä¸ªContext"><a href="#æ¶ˆè´¹å¤šä¸ªContext" class="headerlink" title="æ¶ˆè´¹å¤šä¸ªContext"></a>æ¶ˆè´¹å¤šä¸ªContext</h3><p>ä¸ºäº†ç¡®ä¿ context å¿«é€Ÿè¿›è¡Œé‡æ¸²æŸ“ï¼ŒReact éœ€è¦ä½¿æ¯ä¸€ä¸ª consumers ç»„ä»¶çš„ context åœ¨ç»„ä»¶æ ‘ä¸­æˆä¸ºä¸€ä¸ªå•ç‹¬çš„èŠ‚ç‚¹ã€‚</p>
<pre><code class="hljs plain">&#x2F;&#x2F; Theme contextï¼Œé»˜è®¤çš„ theme æ˜¯ â€œlightâ€ å€¼
const ThemeContext &#x3D; React.createContext(&#39;light&#39;);

&#x2F;&#x2F; ç”¨æˆ·ç™»å½• context
const UserContext &#x3D; React.createContext(&#123;
  name: &#39;Guest&#39;,
&#125;);

class App extends React.Component &#123;
  render() &#123;
    const &#123;signedInUser, theme&#125; &#x3D; this.props;

    &#x2F;&#x2F; æä¾›åˆå§‹ context å€¼çš„ App ç»„ä»¶
    return (
      &lt;ThemeContext.Provider value&#x3D;&#123;theme&#125;&gt;
        &lt;UserContext.Provider value&#x3D;&#123;signedInUser&#125;&gt;
          &lt;Layout &#x2F;&gt;
        &lt;&#x2F;UserContext.Provider&gt;
      &lt;&#x2F;ThemeContext.Provider&gt;
    );
  &#125;
&#125;

function Layout() &#123;
  return (
    &lt;div&gt;
      &lt;Sidebar &#x2F;&gt;
      &lt;Content &#x2F;&gt;
    &lt;&#x2F;div&gt;
  );
&#125;

&#x2F;&#x2F; ä¸€ä¸ªç»„ä»¶å¯èƒ½ä¼šæ¶ˆè´¹å¤šä¸ª context
function Content() &#123;
  return (
    &lt;ThemeContext.Consumer&gt;
      &#123;theme &#x3D;&gt; (
        &lt;UserContext.Consumer&gt;
          &#123;user &#x3D;&gt; (
            &lt;ProfilePage user&#x3D;&#123;user&#125; theme&#x3D;&#123;theme&#125; &#x2F;&gt;
          )&#125;
        &lt;&#x2F;UserContext.Consumer&gt;
      )&#125;
    &lt;&#x2F;ThemeContext.Consumer&gt;
  );
&#125;</code></pre>
<p>å¦‚æœä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„ context å€¼ç»å¸¸è¢«ä¸€èµ·ä½¿ç”¨ï¼Œé‚£ä½ å¯èƒ½è¦è€ƒè™‘ä¸€ä¸‹å¦å¤–åˆ›å»ºä½ è‡ªå·±çš„æ¸²æŸ“ç»„ä»¶ï¼Œä»¥æä¾›è¿™äº›å€¼ã€‚</p>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>ä¸Šé¢ä¹‹æ‰€ä»¥è¦å°†å€¼æ”¾åˆ°é«˜å±‚ç»„ä»¶çš„stateä¸­ï¼Œæ˜¯å› ä¸º context ä¼šä½¿ç”¨å‚è€ƒæ ‡è¯†ï¼ˆreference identityï¼‰æ¥å†³å®šä½•æ—¶è¿›è¡Œæ¸²æŸ“ï¼Œè¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€äº›é™·é˜±ï¼Œå½“ provider çš„çˆ¶ç»„ä»¶è¿›è¡Œé‡æ¸²æŸ“æ—¶ï¼Œå¯èƒ½ä¼šåœ¨ consumers ç»„ä»¶ä¸­è§¦å‘æ„å¤–çš„æ¸²æŸ“ã€‚</p>
<h1 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h1><p>Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚</p>
<p>Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚</p>
<h2 id="è¯ç”ŸåŸå› "><a href="#è¯ç”ŸåŸå› " class="headerlink" title="è¯ç”ŸåŸå› "></a>è¯ç”ŸåŸå› </h2><ul>
<li>åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾</li>
<li>å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£<br>æˆ‘ä»¬ç»å¸¸ç»´æŠ¤ä¸€äº›ç»„ä»¶ï¼Œç»„ä»¶èµ·åˆå¾ˆç®€å•ï¼Œä½†æ˜¯é€æ¸ä¼šè¢«çŠ¶æ€é€»è¾‘å’Œå‰¯ä½œç”¨å……æ–¥ã€‚æ¯ä¸ªç”Ÿå‘½å‘¨æœŸå¸¸å¸¸åŒ…å«ä¸€äº›ä¸ç›¸å…³çš„é€»è¾‘ã€‚åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸å¯èƒ½å°†ç»„ä»¶æ‹†åˆ†ä¸ºæ›´å°çš„ç²’åº¦ï¼Œå› ä¸ºçŠ¶æ€é€»è¾‘æ— å¤„ä¸åœ¨ã€‚è¿™ä¹Ÿç»™æµ‹è¯•å¸¦æ¥äº†ä¸€å®šæŒ‘æˆ˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHook å°†ç»„ä»¶ä¸­ç›¸äº’å…³è”çš„éƒ¨åˆ†æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ï¼ˆæ¯”å¦‚è®¾ç½®è®¢é˜…æˆ–è¯·æ±‚æ•°æ®ï¼‰ï¼Œè€Œå¹¶éå¼ºåˆ¶æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ reducer æ¥ç®¡ç†ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ï¼Œä½¿å…¶æ›´åŠ å¯é¢„æµ‹ã€‚</li>
<li>éš¾ä»¥ç†è§£çš„ class<br>Hook ä½¿ä½ åœ¨é class çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨æ›´å¤šçš„ React ç‰¹æ€§ã€‚ ä»æ¦‚å¿µä¸Šè®²ï¼ŒReact ç»„ä»¶ä¸€ç›´æ›´åƒæ˜¯å‡½æ•°ã€‚è€Œ Hook åˆ™æ‹¥æŠ±äº†å‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰ç‰ºç‰² React çš„ç²¾ç¥åŸåˆ™ã€‚Hook æä¾›äº†é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæ— éœ€å­¦ä¹ å¤æ‚çš„å‡½æ•°å¼æˆ–å“åº”å¼ç¼–ç¨‹æŠ€æœ¯ã€‚</li>
</ul>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å…ˆçœ‹ä¸ªä¾‹å­</p>
<pre><code class="hljs plain">import React, &#123; useState &#125; from &#39;react&#39;;

function Example() &#123;
  &#x2F;&#x2F; å£°æ˜ä¸€ä¸ªå« â€œcountâ€ çš„ state å˜é‡ã€‚
  const [count, setCount] &#x3D; useState(0);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked &#123;count&#125; times&lt;&#x2F;p&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(count + 1)&#125;&gt;
        Click me
      &lt;&#x2F;button&gt;
    &lt;&#x2F;div&gt;
  );
&#125;</code></pre>
<p>useState å°±æ˜¯ä¸€ä¸ª Hook ï¼ˆç­‰ä¸‹æˆ‘ä»¬ä¼šè®²åˆ°è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼‰ã€‚é€šè¿‡åœ¨å‡½æ•°ç»„ä»¶é‡Œè°ƒç”¨å®ƒæ¥ç»™ç»„ä»¶æ·»åŠ ä¸€äº›å†…éƒ¨ stateã€‚React ä¼šåœ¨é‡å¤æ¸²æŸ“æ—¶ä¿ç•™è¿™ä¸ª stateã€‚useState ä¼šè¿”å›ä¸€å¯¹å€¼ï¼šå½“å‰çŠ¶æ€å’Œä¸€ä¸ªè®©ä½ æ›´æ–°å®ƒçš„å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æˆ–å…¶ä»–ä¸€äº›åœ°æ–¹è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚å®ƒç±»ä¼¼ class ç»„ä»¶çš„ this.setStateï¼Œä½†æ˜¯å®ƒä¸ä¼šæŠŠæ–°çš„ state å’Œæ—§çš„ state è¿›è¡Œåˆå¹¶ã€‚<br>useState å”¯ä¸€çš„å‚æ•°å°±æ˜¯åˆå§‹ stateã€‚ä¸åŒäº this.stateï¼Œè¿™é‡Œçš„ state ä¸ä¸€å®šè¦æ˜¯ä¸€ä¸ªå¯¹è±¡.</p>
<p><strong>å£°æ˜å¤šä¸ªstateå˜é‡</strong></p>
<pre><code class="hljs plain">function ExampleWithManyStates() &#123;
  &#x2F;&#x2F; å£°æ˜å¤šä¸ª state å˜é‡ï¼
  const [age, setAge] &#x3D; useState(42);
  const [fruit, setFruit] &#x3D; useState(&#39;banana&#39;);
  const [todos, setTodos] &#x3D; useState([&#123; text: &#39;Learn Hooks&#39; &#125;]);
  &#x2F;&#x2F; ...
&#125;</code></pre>

<p><strong>ä»€ä¹ˆæ˜¯Hook</strong><br>Hook æ˜¯ä¸€äº›å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶é‡Œâ€œé’©å…¥â€ React state åŠç”Ÿå‘½å‘¨æœŸç­‰ç‰¹æ€§çš„å‡½æ•°ã€‚Hook ä¸èƒ½åœ¨ class ç»„ä»¶ä¸­ä½¿ç”¨ â€”â€” è¿™ä½¿å¾—ä½ ä¸ä½¿ç”¨ class ä¹Ÿèƒ½ä½¿ç”¨ Reactã€‚ï¼ˆæˆ‘ä»¬ä¸æ¨èæŠŠä½ å·²æœ‰çš„ç»„ä»¶å…¨éƒ¨é‡å†™ï¼Œä½†æ˜¯ä½ å¯ä»¥åœ¨æ–°ç»„ä»¶é‡Œå¼€å§‹ä½¿ç”¨ Hookã€‚ï¼‰</p>
<p>React å†…ç½®äº†ä¸€äº›åƒ useState è¿™æ ·çš„ Hookã€‚ä½ ä¹Ÿå¯ä»¥åˆ›å»ºä½ è‡ªå·±çš„ Hook æ¥å¤ç”¨ä¸åŒç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘ã€‚æˆ‘ä»¬å…ˆä»‹ç»è¿™äº›å†…ç½®çš„ Hookã€‚</p>
<h2 id="Effect-Hook"><a href="#Effect-Hook" class="headerlink" title="Effect Hook"></a>Effect Hook</h2><p>ä½ ä¹‹å‰å¯èƒ½å·²ç»åœ¨ React ç»„ä»¶ä¸­æ‰§è¡Œè¿‡æ•°æ®è·å–ã€è®¢é˜…æˆ–è€…æ‰‹åŠ¨ä¿®æ”¹è¿‡ DOMã€‚æˆ‘ä»¬ç»Ÿä¸€æŠŠè¿™äº›æ“ä½œç§°ä¸ºâ€œå‰¯ä½œç”¨â€ï¼Œæˆ–è€…ç®€ç§°ä¸ºâ€œä½œç”¨â€ã€‚</p>
<p>useEffect å°±æ˜¯ä¸€ä¸ª Effect Hookï¼Œç»™å‡½æ•°ç»„ä»¶å¢åŠ äº†æ“ä½œå‰¯ä½œç”¨çš„èƒ½åŠ›ã€‚å®ƒè·Ÿ class ç»„ä»¶ä¸­çš„ componentDidMountã€componentDidUpdate å’Œ componentWillUnmount å…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œåªä¸è¿‡è¢«åˆå¹¶æˆäº†ä¸€ä¸ª APIã€‚</p>
<pre><code class="hljs plain">import React, &#123; useState, useEffect &#125; from &#39;react&#39;;

function Example() &#123;
  const [count, setCount] &#x3D; useState(0);

  &#x2F;&#x2F; ç›¸å½“äº componentDidMount å’Œ componentDidUpdate:
  useEffect(() &#x3D;&gt; &#123;
    &#x2F;&#x2F; ä½¿ç”¨æµè§ˆå™¨çš„ API æ›´æ–°é¡µé¢æ ‡é¢˜
    document.title &#x3D; &#96;You clicked $&#123;count&#125; times&#96;;
  &#125;);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked &#123;count&#125; times&lt;&#x2F;p&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(count + 1)&#125;&gt;
        Click me
      &lt;&#x2F;button&gt;
    &lt;&#x2F;div&gt;
  );
&#125;</code></pre>
<p>å½“ä½ è°ƒç”¨ useEffect æ—¶ï¼Œå°±æ˜¯åœ¨å‘Šè¯‰ React åœ¨å®Œæˆå¯¹ DOM çš„æ›´æ”¹åè¿è¡Œä½ çš„â€œå‰¯ä½œç”¨â€å‡½æ•°ã€‚ç”±äºå‰¯ä½œç”¨å‡½æ•°æ˜¯åœ¨ç»„ä»¶å†…å£°æ˜çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥è®¿é—®åˆ°ç»„ä»¶çš„ props å’Œ stateã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè°ƒç”¨å‰¯ä½œç”¨å‡½æ•° â€”â€” åŒ…æ‹¬ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ã€‚</p>
<p>å‰¯ä½œç”¨å‡½æ•°è¿˜å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ªå‡½æ•°æ¥æŒ‡å®šå¦‚ä½•â€œæ¸…é™¤â€å‰¯ä½œç”¨ã€‚</p>
<pre><code class="hljs plain">import React, &#123; useState, useEffect &#125; from &#39;react&#39;;

function FriendStatus(props) &#123;
  const [isOnline, setIsOnline] &#x3D; useState(null);

  function handleStatusChange(status) &#123;
    setIsOnline(status.isOnline);
  &#125;

  useEffect(() &#x3D;&gt; &#123;
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    return () &#x3D;&gt; &#123;
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    &#125;;
  &#125;);

  if (isOnline &#x3D;&#x3D;&#x3D; null) &#123;
    return &#39;Loading...&#39;;
  &#125;
  return isOnline ? &#39;Online&#39; : &#39;Offline&#39;;
&#125;</code></pre>

<p>è·Ÿ useState ä¸€æ ·ï¼Œä½ å¯ä»¥åœ¨ç»„ä»¶ä¸­å¤šæ¬¡ä½¿ç”¨ useEffectã€‚<br>é€šè¿‡ä½¿ç”¨ Hookï¼Œä½ å¯ä»¥æŠŠç»„ä»¶å†…ç›¸å…³çš„å‰¯ä½œç”¨ç»„ç»‡åœ¨ä¸€èµ·ï¼ˆä¾‹å¦‚åˆ›å»ºè®¢é˜…åŠå–æ¶ˆè®¢é˜…ï¼‰ï¼Œè€Œä¸è¦æŠŠå®ƒä»¬æ‹†åˆ†åˆ°ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°é‡Œã€‚</p>
<h2 id="hookä½¿ç”¨è§„åˆ™"><a href="#hookä½¿ç”¨è§„åˆ™" class="headerlink" title="hookä½¿ç”¨è§„åˆ™"></a>hookä½¿ç”¨è§„åˆ™</h2><p>Hook å°±æ˜¯ JavaScript å‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒä»¬ä¼šæœ‰ä¸¤ä¸ªé¢å¤–çš„è§„åˆ™ï¼š</p>
<ul>
<li>åªèƒ½åœ¨å‡½æ•°æœ€å¤–å±‚è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…å­å‡½æ•°ä¸­è°ƒç”¨ã€‚</li>
<li>åªèƒ½åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å…¶ä»– JavaScript å‡½æ•°ä¸­è°ƒç”¨ã€‚ï¼ˆè¿˜æœ‰ä¸€ä¸ªåœ°æ–¹å¯ä»¥è°ƒç”¨ Hook â€”â€” å°±æ˜¯è‡ªå®šä¹‰çš„ Hook ä¸­ï¼Œæˆ‘ä»¬ç¨åä¼šå­¦ä¹ åˆ°ã€‚ï¼‰</li>
</ul>
<h2 id="è‡ªå®šä¹‰Hook"><a href="#è‡ªå®šä¹‰Hook" class="headerlink" title="è‡ªå®šä¹‰Hook"></a>è‡ªå®šä¹‰Hook</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæƒ³è¦åœ¨ç»„ä»¶ä¹‹é—´é‡ç”¨ä¸€äº›çŠ¶æ€é€»è¾‘ã€‚ç›®å‰ä¸ºæ­¢ï¼Œæœ‰ä¸¤ç§ä¸»æµæ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šé«˜é˜¶ç»„ä»¶å’Œ render propsã€‚è‡ªå®šä¹‰ Hook å¯ä»¥è®©ä½ åœ¨ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚</p>
<pre><code class="hljs plain">import React, &#123; useState, useEffect &#125; from &#39;react&#39;;

function useFriendStatus(friendID) &#123;
  const [isOnline, setIsOnline] &#x3D; useState(null);

  function handleStatusChange(status) &#123;
    setIsOnline(status.isOnline);
  &#125;

  useEffect(() &#x3D;&gt; &#123;
    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);
    return () &#x3D;&gt; &#123;
      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);
    &#125;;
  &#125;);

  return isOnline;
&#125;</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ä½¿ç”¨å®ƒï¼š</p>
<pre><code class="hljs plain">function FriendStatus(props) &#123;
  const isOnline &#x3D; useFriendStatus(props.friend.id);

  if (isOnline &#x3D;&#x3D;&#x3D; null) &#123;
    return &#39;Loading...&#39;;
  &#125;
  return isOnline ? &#39;Online&#39; : &#39;Offline&#39;;
&#125;</code></pre>
<pre><code class="hljs plain">function FriendListItem(props) &#123;
  const isOnline &#x3D; useFriendStatus(props.friend.id);

  return (
    &lt;li style&#x3D;&#123;&#123; color: isOnline ? &#39;green&#39; : &#39;black&#39; &#125;&#125;&gt;
      &#123;props.friend.name&#125;
    &lt;&#x2F;li&gt;
  );
&#125;</code></pre>
<p>è¿™ä¸¤ä¸ªç»„ä»¶çš„ state æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚Hook æ˜¯ä¸€ç§å¤ç”¨çŠ¶æ€é€»è¾‘çš„æ–¹å¼ï¼Œå®ƒä¸å¤ç”¨ state æœ¬èº«ã€‚äº‹å®ä¸Š Hook çš„æ¯æ¬¡è°ƒç”¨éƒ½æœ‰ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ state â€”â€” å› æ­¤ä½ å¯ä»¥åœ¨å•ä¸ªç»„ä»¶ä¸­å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªè‡ªå®šä¹‰ Hookã€‚</p>
<p>è‡ªå®šä¹‰ Hook æ›´åƒæ˜¯ä¸€ç§çº¦å®šè€Œä¸æ˜¯åŠŸèƒ½ã€‚å¦‚æœå‡½æ•°çš„åå­—ä»¥ â€œuseâ€ å¼€å¤´å¹¶è°ƒç”¨å…¶ä»– Hookï¼Œæˆ‘ä»¬å°±è¯´è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ Hookã€‚ useSomething çš„å‘½åçº¦å®šå¯ä»¥è®©æˆ‘ä»¬çš„ linter æ’ä»¶åœ¨ä½¿ç”¨ Hook çš„ä»£ç ä¸­æ‰¾åˆ° bugã€‚</p>
<p>ä½ å¯ä»¥åˆ›å»ºæ¶µç›–å„ç§åœºæ™¯çš„è‡ªå®šä¹‰ Hookï¼Œå¦‚è¡¨å•å¤„ç†ã€åŠ¨ç”»ã€è®¢é˜…å£°æ˜ã€è®¡æ—¶å™¨ï¼Œç”šè‡³å¯èƒ½è¿˜æœ‰æ›´å¤šæˆ‘ä»¬æ²¡æƒ³åˆ°çš„åœºæ™¯ã€‚æˆ‘ä»¬å¾ˆæœŸå¾…çœ‹åˆ° React ç¤¾åŒºä¼šå‡ºç°ä»€ä¹ˆæ ·çš„è‡ªå®šä¹‰ Hookã€‚</p>
<h2 id="å…¶å®ƒhook"><a href="#å…¶å®ƒhook" class="headerlink" title="å…¶å®ƒhook"></a>å…¶å®ƒhook</h2><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä½¿ç”¨é¢‘ç‡è¾ƒä½çš„ä½†æ˜¯å¾ˆæœ‰ç”¨çš„ Hookã€‚æ¯”å¦‚ï¼ŒuseContext è®©ä½ ä¸ä½¿ç”¨ç»„ä»¶åµŒå¥—å°±å¯ä»¥è®¢é˜… React çš„ Contextã€‚</p>
<pre><code class="hljs plain">function Example() &#123;
  const locale &#x3D; useContext(LocaleContext);
  const theme &#x3D; useContext(ThemeContext);
  &#x2F;&#x2F; ...
&#125;</code></pre>

<p>å¦å¤– useReducer å¯ä»¥è®©ä½ é€šè¿‡ reducer æ¥ç®¡ç†ç»„ä»¶æœ¬åœ°çš„å¤æ‚ stateã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›ä¸€æ­¥çš„æ¥çœ‹è¿™äº›APIåˆ°åº•åšäº†ä»€ä¹ˆã€‚</p>
<h2 id="useStateæ–¹æ³•è¯´æ˜"><a href="#useStateæ–¹æ³•è¯´æ˜" class="headerlink" title="useStateæ–¹æ³•è¯´æ˜"></a>useStateæ–¹æ³•è¯´æ˜</h2><p>è°ƒç”¨ useState æ–¹æ³•çš„æ—¶å€™åšäº†ä»€ä¹ˆ? å®ƒå®šä¹‰ä¸€ä¸ª â€œstate å˜é‡â€ã€‚æˆ‘ä»¬çš„å˜é‡å« countï¼Œ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å«ä»–ä»»ä½•åå­—ï¼Œæ¯”å¦‚ bananaã€‚è¿™æ˜¯ä¸€ç§åœ¨å‡½æ•°è°ƒç”¨æ—¶ä¿å­˜å˜é‡çš„æ–¹å¼ â€”â€” useState æ˜¯ä¸€ç§æ–°æ–¹æ³•ï¼Œå®ƒä¸ class é‡Œé¢çš„ this.state æä¾›çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å‡½æ•°é€€å‡ºåå˜é‡å°±ä¼šâ€æ¶ˆå¤±â€ï¼Œè€Œ state ä¸­çš„å˜é‡ä¼šè¢« React ä¿ç•™ã€‚</p>
<p>useState éœ€è¦å“ªäº›å‚æ•°ï¼Ÿ useState() æ–¹æ³•é‡Œé¢å”¯ä¸€çš„å‚æ•°å°±æ˜¯åˆå§‹ stateã€‚ä¸åŒäº class çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§éœ€è¦ä½¿ç”¨æ•°å­—æˆ–å­—ç¬¦ä¸²å¯¹å…¶è¿›è¡Œèµ‹å€¼ï¼Œè€Œä¸ä¸€å®šæ˜¯å¯¹è±¡ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œåªéœ€ä½¿ç”¨æ•°å­—æ¥è®°å½•ç”¨æˆ·ç‚¹å‡»æ¬¡æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ äº† 0 ä½œä¸ºå˜é‡çš„åˆå§‹ stateã€‚ï¼ˆå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ state ä¸­å­˜å‚¨ä¸¤ä¸ªä¸åŒçš„å˜é‡ï¼Œåªéœ€è°ƒç”¨ useState() ä¸¤æ¬¡å³å¯ã€‚ï¼‰</p>
<p>useState æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Ÿ è¿”å›å€¼ä¸ºï¼šå½“å‰ state ä»¥åŠæ›´æ–° state çš„å‡½æ•°ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å†™ const [count, setCount] = useState() çš„åŸå› ã€‚è¿™ä¸ class é‡Œé¢ this.state.count å’Œ this.setState ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯ä½ éœ€è¦æˆå¯¹çš„è·å–å®ƒä»¬ã€‚</p>
<p>ä½ ä¸å¿…ä½¿ç”¨å¤šä¸ª state å˜é‡ã€‚State å˜é‡å¯ä»¥å¾ˆå¥½åœ°å­˜å‚¨å¯¹è±¡å’Œæ•°ç»„ï¼Œå› æ­¤ï¼Œä½ ä»ç„¶å¯ä»¥å°†ç›¸å…³æ•°æ®åˆ†ä¸ºä¸€ç»„ã€‚ç„¶è€Œï¼Œä¸åƒ class ä¸­çš„ this.setStateï¼Œæ›´æ–° state å˜é‡æ€»æ˜¯æ›¿æ¢å®ƒè€Œä¸æ˜¯åˆå¹¶å®ƒã€‚</p>
<h2 id="ä½¿ç”¨Effect-Hook"><a href="#ä½¿ç”¨Effect-Hook" class="headerlink" title="ä½¿ç”¨Effect Hook"></a>ä½¿ç”¨Effect Hook</h2><p>åœ¨ React ç»„ä»¶ä¸­æœ‰ä¸¤ç§å¸¸è§å‰¯ä½œç”¨æ“ä½œï¼šéœ€è¦æ¸…é™¤çš„å’Œä¸éœ€è¦æ¸…é™¤çš„ã€‚æˆ‘ä»¬æ¥æ›´ä»”ç»†åœ°çœ‹ä¸€ä¸‹ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<h3 id="æ— éœ€æ¸…é™¤çš„effect"><a href="#æ— éœ€æ¸…é™¤çš„effect" class="headerlink" title="æ— éœ€æ¸…é™¤çš„effect"></a>æ— éœ€æ¸…é™¤çš„effect</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åªæƒ³åœ¨ React æ›´æ–° DOM ä¹‹åè¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ã€‚æ¯”å¦‚<strong>å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—</strong>ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œã€‚å› ä¸ºæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œè¿™äº›æ“ä½œä¹‹åï¼Œå°±å¯ä»¥å¿½ç•¥ä»–ä»¬äº†ã€‚è®©æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä½¿ç”¨ class å’Œ Hook éƒ½æ˜¯æ€ä¹ˆå®ç°è¿™äº›å‰¯ä½œç”¨çš„ã€‚</p>
<p><strong>class</strong>:</p>
<pre><code class="hljs plain">class Example extends React.Component &#123;
  constructor(props) &#123;
    super(props);
    this.state &#x3D; &#123;
      count: 0
    &#125;;
  &#125;

  componentDidMount() &#123;
    document.title &#x3D; &#96;You clicked $&#123;this.state.count&#125; times&#96;;
  &#125;
  componentDidUpdate() &#123;
    document.title &#x3D; &#96;You clicked $&#123;this.state.count&#125; times&#96;;
  &#125;

  render() &#123;
    return (
      &lt;div&gt;
        &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;&#x2F;p&gt;
        &lt;button onClick&#x3D;&#123;() &#x3D;&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt;
          Click me
        &lt;&#x2F;button&gt;
      &lt;&#x2F;div&gt;
    );
  &#125;
&#125;</code></pre>

<p><strong>ä½¿ç”¨Hook</strong>ï¼š</p>
<pre><code class="hljs plain">import React, &#123; useState, useEffect &#125; from &#39;react&#39;;

function Example() &#123;
  const [count, setCount] &#x3D; useState(0);

  useEffect(() &#x3D;&gt; &#123;
    document.title &#x3D; &#96;You clicked $&#123;count&#125; times&#96;;
  &#125;);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked &#123;count&#125; times&lt;&#x2F;p&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(count + 1)&#125;&gt;
        Click me
      &lt;&#x2F;button&gt;
    &lt;&#x2F;div&gt;
  );
&#125;</code></pre>
<p>useEffect åšäº†ä»€ä¹ˆï¼Ÿ é€šè¿‡ä½¿ç”¨è¿™ä¸ª Hookï¼Œä½ å¯ä»¥å‘Šè¯‰ React ç»„ä»¶éœ€è¦åœ¨æ¸²æŸ“åæ‰§è¡ŒæŸäº›æ“ä½œã€‚</p>
<p>useEffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œå—ï¼Ÿ æ˜¯çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚ï¼ˆæˆ‘ä»¬ç¨åä¼šè°ˆåˆ°å¦‚ä½•æ§åˆ¶å®ƒã€‚ï¼‰ä½ å¯èƒ½ä¼šæ›´å®¹æ˜“æ¥å— effect å‘ç”Ÿåœ¨â€œæ¸²æŸ“ä¹‹åâ€è¿™ç§æ¦‚å¿µï¼Œä¸ç”¨å†å»è€ƒè™‘â€œæŒ‚è½½â€è¿˜æ˜¯â€œæ›´æ–°â€ã€‚React ä¿è¯äº†æ¯æ¬¡è¿è¡Œ effect çš„åŒæ—¶ï¼ŒDOM éƒ½å·²ç»æ›´æ–°å®Œæ¯•ã€‚</p>
<p>ä¸ componentDidMount æˆ– componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffect ä¸éœ€è¦åŒæ­¥åœ°æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ useLayoutEffect Hook ä¾›ä½ ä½¿ç”¨ï¼Œå…¶ API ä¸ useEffect ç›¸åŒã€‚</p>
<h3 id="éœ€è¦æ¸…é™¤çš„effect"><a href="#éœ€è¦æ¸…é™¤çš„effect" class="headerlink" title="éœ€è¦æ¸…é™¤çš„effect"></a>éœ€è¦æ¸…é™¤çš„effect</h3><p>ä¹‹å‰ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•ä½¿ç”¨ä¸éœ€è¦æ¸…é™¤çš„å‰¯ä½œç”¨ï¼Œè¿˜æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ã€‚ä¾‹å¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²ï¼ç°åœ¨è®©æˆ‘ä»¬æ¥æ¯”è¾ƒä¸€ä¸‹å¦‚ä½•ç”¨ Class å’Œ Hook æ¥å®ç°ã€‚</p>
<p>åœ¨ React class ä¸­ï¼Œä½ é€šå¸¸ä¼šåœ¨ componentDidMount ä¸­è®¾ç½®è®¢é˜…ï¼Œå¹¶åœ¨ componentWillUnmount ä¸­æ¸…é™¤å®ƒã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª ChatAPI æ¨¡å—ï¼Œå®ƒå…è®¸æˆ‘ä»¬è®¢é˜…å¥½å‹çš„åœ¨çº¿çŠ¶æ€ã€‚<br><strong>ä½¿ç”¨class</strong><br>ç•¥</p>
<p><strong>ä½¿ç”¨Hook</strong><br>ä½ å¯èƒ½è®¤ä¸ºéœ€è¦å•ç‹¬çš„ effect æ¥æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚ä½†ç”±äºæ·»åŠ å’Œåˆ é™¤è®¢é˜…çš„ä»£ç çš„ç´§å¯†æ€§ï¼Œæ‰€ä»¥ useEffect çš„è®¾è®¡æ˜¯åœ¨åŒä¸€ä¸ªåœ°æ–¹æ‰§è¡Œã€‚<strong>å¦‚æœä½ çš„ effect è¿”å›ä¸€ä¸ªå‡½æ•°ï¼ŒReact å°†ä¼šåœ¨æ‰§è¡Œæ¸…é™¤æ“ä½œæ—¶è°ƒç”¨å®ƒ</strong>ï¼š</p>
<pre><code class="hljs plain">import React, &#123; useState, useEffect &#125; from &#39;react&#39;;

function FriendStatus(props) &#123;
  const [isOnline, setIsOnline] &#x3D; useState(null);

  useEffect(() &#x3D;&gt; &#123;
    function handleStatusChange(status) &#123;
      setIsOnline(status.isOnline);
    &#125;
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    &#x2F;&#x2F; Specify how to clean up after this effect:  å®é™…ä¸Šå‡½æ•°åä¸é‡è¦ï¼Œç®­å¤´å‡½æ•°ä¹Ÿè¡Œï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†ä½“ç°å…¶ä½œç”¨
    return function cleanup() &#123;
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    &#125;;
  &#125;);

  if (isOnline &#x3D;&#x3D;&#x3D; null) &#123;
    return &#39;Loading...&#39;;
  &#125;
  return isOnline ? &#39;Online&#39; : &#39;Offline&#39;;
&#125;</code></pre>

<p>ä¸ºä»€ä¹ˆè¦åœ¨ effect ä¸­è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Ÿ è¿™æ˜¯ effect å¯é€‰çš„æ¸…é™¤æœºåˆ¶ã€‚æ¯ä¸ª effect éƒ½å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ã€‚å¦‚æ­¤å¯ä»¥å°†æ·»åŠ å’Œç§»é™¤è®¢é˜…çš„é€»è¾‘æ”¾åœ¨ä¸€èµ·ã€‚å®ƒä»¬éƒ½å±äº effect çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>React ä½•æ—¶æ¸…é™¤ effectï¼Ÿ React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚æ­£å¦‚ä¹‹å‰å­¦åˆ°çš„ï¼Œeffect åœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React ä¼šåœ¨æ‰§è¡Œå½“å‰ effect ä¹‹å‰å¯¹ä¸Šä¸€ä¸ª effect è¿›è¡Œæ¸…é™¤ã€‚æˆ‘ä»¬ç¨åå°†è®¨è®º<a href="https://zh-hans.reactjs.org/docs/hooks-effect.html#explanation-why-effects-run-on-each-update" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆè¿™å°†åŠ©äºé¿å… bug</a>ä»¥åŠ<a href="https://zh-hans.reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects" target="_blank" rel="noopener">å¦‚ä½•åœ¨é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶è·³è¿‡æ­¤è¡Œä¸º</a>ã€‚</p>
<h3 id="ä½¿ç”¨å¤šä¸ªeffectå®ç°å…³æ³¨ç‚¹åˆ†ç¦»"><a href="#ä½¿ç”¨å¤šä¸ªeffectå®ç°å…³æ³¨ç‚¹åˆ†ç¦»" class="headerlink" title="ä½¿ç”¨å¤šä¸ªeffectå®ç°å…³æ³¨ç‚¹åˆ†ç¦»"></a>ä½¿ç”¨å¤šä¸ªeffectå®ç°å…³æ³¨ç‚¹åˆ†ç¦»</h3><p>æˆ‘ä»¬çš„classä¸­çš„å£°æ˜å‘¨æœŸå‡½æ•°å†…ç»å¸¸éœ€è¦åŒ…å«å¦‚ä¸Šä¾‹å­è¿™æ ·çš„ä¸ç›¸å…³é€»è¾‘ï¼Œè€Œclasså†™æ³•é‡Œè¿™äº›é€»è¾‘æ— ç–‘ä¼šè¢«åˆ†å‰²åˆ°ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæ¯”å¦‚componentWillMountä¸­è®¢é˜…ï¼ŒcompnentWillUnmountä¸­å–æ¶ˆè®¢é˜…ç­‰ã€‚è€Œå¦‚æœè¿™æ ·çš„ä»£ç è¾ƒå¤šï¼Œæˆ‘ä»¬è¿˜è¦åœ¨åŒä¸ªç”Ÿå‘½å‘¨æœŸä¸­åšä¸åŒçš„äº‹æƒ…ï¼Œè®©ä»£ç å˜å¾—æ›´åŠ éš¾ä»¥ç†è§£ã€‚<br>Hookçš„å¦ä¸€ä¸ªä½œç”¨ï¼Œ<strong>å°±æ˜¯å…è®¸æˆ‘ä»¬æŒ‰ç…§ä»£ç çš„ç”¨é€”æ¥åˆ†ç¦»ä»–ä»¬</strong>ã€‚</p>
<pre><code class="hljs plain">function FriendStatusWithCounter(props) &#123;
  const [count, setCount] &#x3D; useState(0);
  useEffect(() &#x3D;&gt; &#123;
    document.title &#x3D; &#96;You clicked $&#123;count&#125; times&#96;;
  &#125;);

  const [isOnline, setIsOnline] &#x3D; useState(null);
  useEffect(() &#x3D;&gt; &#123;
    function handleStatusChange(status) &#123;
      setIsOnline(status.isOnline);
    &#125;

    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    return () &#x3D;&gt; &#123;
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    &#125;;
  &#125;);
  &#x2F;&#x2F; ...
&#125;</code></pre>

<h3 id="ä¸ºä»€ä¹ˆæ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½éœ€è¦è¿è¡Œeffect"><a href="#ä¸ºä»€ä¹ˆæ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½éœ€è¦è¿è¡Œeffect" class="headerlink" title="ä¸ºä»€ä¹ˆæ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½éœ€è¦è¿è¡Œeffect"></a>ä¸ºä»€ä¹ˆæ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½éœ€è¦è¿è¡Œeffect</h3><p>å¦‚æœä½ å·²ç»ä¹ æƒ¯äº†ä½¿ç”¨ classï¼Œé‚£ä¹ˆä½ æˆ–è®¸ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆ effect çš„æ¸…é™¤é˜¶æ®µåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šæ‰§è¡Œï¼Œè€Œä¸æ˜¯åªåœ¨å¸è½½ç»„ä»¶çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ä¸ªè®¾è®¡å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»º bug æ›´å°‘çš„ç»„ä»¶ã€‚</p>
<pre><code class="hljs plain">componentDidMount() &#123;
    ChatAPI.subscribeToFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  &#125;

  componentWillUnmount() &#123;
    ChatAPI.unsubscribeFromFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  &#125;</code></pre>
<p>å¦‚ä¸Šï¼Œè€ƒè™‘åŸæ¥çš„ä»£ç ï¼Œ<strong>å½“ç»„ä»¶å·²ç»æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶ï¼Œfriend prop å‘ç”Ÿå˜åŒ–æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ</strong>ï¼Ÿ æˆ‘ä»¬çš„ç»„ä»¶å°†ç»§ç»­å±•ç¤ºåŸæ¥çš„å¥½å‹çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ª bugã€‚è€Œä¸”æˆ‘ä»¬è¿˜ä¼šå› ä¸ºå–æ¶ˆè®¢é˜…æ—¶ä½¿ç”¨é”™è¯¯çš„å¥½å‹ ID å¯¼è‡´å†…å­˜æ³„éœ²æˆ–å´©æºƒçš„é—®é¢˜ã€‚</p>
<p>åœ¨ class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  componentDidUpdate æ¥è§£å†³è¿™ä¸ªé—®é¢˜:</p>
<pre><code class="hljs plain">componentDidUpdate(prevProps) &#123;
    &#x2F;&#x2F; å–æ¶ˆè®¢é˜…ä¹‹å‰çš„ friend.id
    ChatAPI.unsubscribeFromFriendStatus(
      prevProps.friend.id,
      this.handleStatusChange
    );
    &#x2F;&#x2F; è®¢é˜…æ–°çš„ friend.id
    ChatAPI.subscribeToFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  &#125;</code></pre>
<p>è€Œhookå°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚</p>
<h3 id="è·³è¿‡effectè¿›è¡Œæ€§èƒ½ä¼˜åŒ–"><a href="#è·³è¿‡effectè¿›è¡Œæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="è·³è¿‡effectè¿›è¡Œæ€§èƒ½ä¼˜åŒ–"></a>è·³è¿‡effectè¿›è¡Œæ€§èƒ½ä¼˜åŒ–</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œæ¸…ç†æˆ–è€…æ‰§è¡Œ effect å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚åœ¨ class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ componentDidUpdate ä¸­æ·»åŠ å¯¹ prevProps æˆ– prevState çš„æ¯”è¾ƒé€»è¾‘è§£å†³ï¼š</p>
<pre><code class="hljs plain">componentDidUpdate(prevProps, prevState) &#123;
  if (prevState.count !&#x3D;&#x3D; this.state.count) &#123;
    document.title &#x3D; &#96;You clicked $&#123;this.state.count&#125; times&#96;;
  &#125;
&#125;</code></pre>

<p>è¿™æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œæ‰€ä»¥å®ƒè¢«å†…ç½®åˆ°äº† useEffect çš„ Hook API ä¸­ã€‚å¦‚æœæŸäº›ç‰¹å®šå€¼åœ¨ä¸¤æ¬¡é‡æ¸²æŸ“ä¹‹é—´æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½ å¯ä»¥é€šçŸ¥ React è·³è¿‡å¯¹ effect çš„è°ƒç”¨ï¼Œåªè¦ä¼ é€’æ•°ç»„ä½œä¸º useEffect çš„ç¬¬äºŒä¸ªå¯é€‰å‚æ•°å³å¯ï¼š</p>
<pre><code class="hljs plain">useEffect(() &#x3D;&gt; &#123;
  document.title &#x3D; &#96;You clicked $&#123;count&#125; times&#96;;
&#125;, [count]); &#x2F;&#x2F; ä»…åœ¨ count æ›´æ”¹æ—¶æ›´æ–°</code></pre>
<p>ç›¸å½“äºæŠŠå½“å‰çš„countä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ï¼Œé‡æ¸²æŸ“è°ƒç”¨effectçš„æ—¶å€™reactä¼šæ¯”è¾ƒå½¼æ—¶çš„countå’Œæˆ‘ä»¬ä¼ å…¥çš„countï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™reactä¼šè·³è¿‡è¿™ä¸ªeffectã€‚<br><strong>æƒ³åˆ¤æ–­å“ªä¸ªå‚æ•°ï¼Œå°±ä¼ å…¥å“ªä¸ªå‚æ•°ã€‚</strong>å¯¹äºæœ‰æ¸…é™¤æ“ä½œçš„effectåŒæ ·é€‚ç”¨ã€‚</p>
<pre><code class="hljs plain">useEffect(() &#x3D;&gt; &#123;
  function handleStatusChange(status) &#123;
    setIsOnline(status.isOnline);
  &#125;

  ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
  return () &#x3D;&gt; &#123;
    ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
  &#125;;
&#125;, [props.friend.id]); &#x2F;&#x2F; ä»…åœ¨ props.friend.id å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°è®¢é˜…</code></pre>
<p>æœªæ¥ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šåœ¨æ„å»ºæ—¶è‡ªåŠ¨æ·»åŠ ç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š<br>å¦‚æœä½ è¦ä½¿ç”¨æ­¤ä¼˜åŒ–æ–¹å¼ï¼Œè¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†<strong>æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šéšæ—¶é—´å˜åŒ–å¹¶ä¸”åœ¨effectä¸­ä½¿ç”¨çš„å˜é‡</strong>ï¼Œå¦åˆ™ä½ çš„ä»£ç ä¼šå¼•ç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚å‚é˜…æ–‡æ¡£ï¼Œäº†è§£æ›´å¤šå…³äº<a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">å¦‚ä½•å¤„ç†å‡½æ•°</a>ä»¥åŠ<a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#what-can-i-do-if-my-effect-dependencies-change-too-often" target="_blank" rel="noopener">æ•°ç»„é¢‘ç¹å˜åŒ–æ—¶çš„æªæ–½</a>å†…å®¹ã€‚</p>
<p><strong>å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰</strong>ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™å°±å‘Šè¯‰ React ä½ çš„ effect ä¸ä¾èµ–äº props æˆ– state ä¸­çš„ä»»ä½•å€¼ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œéƒ½ä¸éœ€è¦é‡å¤æ‰§è¡Œã€‚è¿™å¹¶ä¸å±äºç‰¹æ®Šæƒ…å†µ â€”â€” å®ƒä¾ç„¶éµå¾ªä¾èµ–æ•°ç»„çš„å·¥ä½œæ–¹å¼ã€‚ </p>
<p>å¦‚æœä½ ä¼ å…¥äº†ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ï¼Œeffect å†…éƒ¨çš„ props å’Œ state å°±ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚å°½ç®¡ä¼ å…¥ [] ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æ›´æ¥è¿‘å¤§å®¶æ›´ç†Ÿæ‚‰çš„ componentDidMount å’Œ componentWillUnmount æ€ç»´æ¨¡å¼ï¼Œä½†æˆ‘ä»¬æœ‰<a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">æ›´å¥½çš„æ–¹å¼</a>æ¥é¿å…è¿‡äºé¢‘ç¹çš„é‡å¤è°ƒç”¨ effectã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯·è®°å¾— React ä¼šç­‰å¾…æµè§ˆå™¨å®Œæˆç”»é¢æ¸²æŸ“ä¹‹åæ‰ä¼šå»¶è¿Ÿè°ƒç”¨ useEffectï¼Œå› æ­¤ä¼šä½¿å¾—é¢å¤–æ“ä½œå¾ˆæ–¹ä¾¿ã€‚</p>
<p>æˆ‘ä»¬æ¨èå¯ç”¨ <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks#installation" target="_blank" rel="noopener">eslint-plugin-react-hooks</a> ä¸­çš„ <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">exhaustive-deps</a> è§„åˆ™ã€‚æ­¤è§„åˆ™ä¼šåœ¨æ·»åŠ é”™è¯¯ä¾èµ–æ—¶å‘å‡ºè­¦å‘Šå¹¶ç»™å‡ºä¿®å¤å»ºè®®ã€‚</p>
<p>æ­¤æ—¶ä½ å¯èƒ½ä¼šå¥½å¥‡ Hook æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚åœ¨ä¸¤æ¬¡æ¸²æŸ“é—´ï¼ŒReactå¦‚ä½•çŸ¥é“å“ªä¸ª useState è°ƒç”¨å¯¹åº”äºå“ªä¸ª state å˜é‡ï¼ŸReact åˆæ˜¯å¦‚ä½•åŒ¹é…å‰åä¸¤æ¬¡æ¸²æŸ“ä¸­çš„æ¯ä¸€ä¸ª effect çš„ï¼Ÿæ¥ç€æ¥çœ‹ã€‚</p>
<h2 id="hookè§„åˆ™"><a href="#hookè§„åˆ™" class="headerlink" title="hookè§„åˆ™"></a>hookè§„åˆ™</h2><p>Hook æœ¬è´¨å°±æ˜¯ JavaScript å‡½æ•°ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å®ƒæ—¶éœ€è¦éµå¾ªä¸¤æ¡è§„åˆ™ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="noopener">linter æ’ä»¶</a>æ¥å¼ºåˆ¶æ‰§è¡Œè¿™äº›è§„åˆ™ï¼š</p>
<ol>
<li>åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook<br>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookï¼Œ ç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„ React å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨ä»–ä»¬ã€‚éµå®ˆè¿™æ¡è§„åˆ™ï¼Œä½ å°±èƒ½ç¡®ä¿ Hook åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½æŒ‰ç…§åŒæ ·çš„é¡ºåºè¢«è°ƒç”¨ã€‚è¿™è®© React èƒ½å¤Ÿåœ¨å¤šæ¬¡çš„ useState å’Œ useEffect è°ƒç”¨ä¹‹é—´ä¿æŒ hook çŠ¶æ€çš„æ­£ç¡®ã€‚</li>
<li>åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hook<br>ä¸è¦åœ¨æ™®é€šçš„ JavaScript å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚ä½ å¯ä»¥ï¼š<br>âœ… åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hook<br>âœ… åœ¨è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨å…¶ä»– Hook</li>
</ol>
<h3 id="eslintæ’ä»¶"><a href="#eslintæ’ä»¶" class="headerlink" title="eslintæ’ä»¶"></a>eslintæ’ä»¶</h3><p>æˆ‘ä»¬å‘å¸ƒäº†ä¸€ä¸ªåä¸º eslint-plugin-react-hooks çš„ ESLint æ’ä»¶æ¥å¼ºåˆ¶æ‰§è¡Œè¿™ä¸¤æ¡è§„åˆ™ã€‚</p>
<pre><code class="hljs plain">npm install eslint-plugin-react-hooks --save-dev</code></pre>
<pre><code class="hljs plain">&#x2F;&#x2F; ä½ çš„ ESLint é…ç½®
&#123;
  &quot;plugins&quot;: [
    &#x2F;&#x2F; ...
    &quot;react-hooks&quot;
  ],
  &quot;rules&quot;: &#123;
    &#x2F;&#x2F; ...
    &quot;react-hooks&#x2F;rules-of-hooks&quot;: &quot;error&quot;, &#x2F;&#x2F; æ£€æŸ¥ Hook çš„è§„åˆ™
    &quot;react-hooks&#x2F;exhaustive-deps&quot;: &quot;warn&quot; &#x2F;&#x2F; æ£€æŸ¥ effect çš„ä¾èµ–
  &#125;
&#125;</code></pre>
<p>å›ç­”ä¸Šé¢çš„é—®é¢˜ï¼ŒReact æ€ä¹ˆçŸ¥é“å“ªä¸ª state å¯¹åº”å“ªä¸ª useStateï¼Ÿç­”æ¡ˆæ˜¯ React é çš„æ˜¯ Hook è°ƒç”¨çš„é¡ºåºã€‚<br>åªè¦ Hook çš„è°ƒç”¨é¡ºåºåœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ä¿æŒä¸€è‡´ï¼ŒReact å°±èƒ½æ­£ç¡®åœ°å°†å†…éƒ¨ state å’Œå¯¹åº”çš„ Hook è¿›è¡Œå…³è”ã€‚ä½†å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ª Hook (ä¾‹å¦‚ persistForm effect) è°ƒç”¨æ”¾åˆ°ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸­ï¼ŒHookçš„è°ƒç”¨é¡ºåºå¯èƒ½å°±ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä»è€Œå¯¼è‡´bugã€‚</p>
<pre><code class="hljs plain">&#x2F;&#x2F; ğŸ”´ åœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ Hook è¿åç¬¬ä¸€æ¡è§„åˆ™
  if (name !&#x3D;&#x3D; &#39;&#39;) &#123;
    useEffect(function persistForm() &#123;
      localStorage.setItem(&#39;formData&#39;, name);
    &#125;);
  &#125;</code></pre>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Hook éœ€è¦åœ¨æˆ‘ä»¬ç»„ä»¶çš„æœ€é¡¶å±‚è°ƒç”¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æœ‰æ¡ä»¶åœ°æ‰§è¡Œä¸€ä¸ª effectï¼Œå¯ä»¥å°†åˆ¤æ–­æ”¾åˆ° Hook çš„å†…éƒ¨ï¼š</p>
<pre><code class="hljs plain">useEffect(function persistForm() &#123;
   &#x2F;&#x2F; ğŸ‘ å°†æ¡ä»¶åˆ¤æ–­æ”¾ç½®åœ¨ effect ä¸­
   if (name !&#x3D;&#x3D; &#39;&#39;) &#123;
     localStorage.setItem(&#39;formData&#39;, name);
   &#125;
 &#125;);</code></pre>

<p><strong>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨äº†æä¾›çš„ lint æ’ä»¶ï¼Œå°±æ— éœ€æ‹…å¿ƒæ­¤é—®é¢˜ã€‚</strong></p>
<h2 id="è‡ªå®šä¹‰Hook-1"><a href="#è‡ªå®šä¹‰Hook-1" class="headerlink" title="è‡ªå®šä¹‰Hook"></a>è‡ªå®šä¹‰Hook</h2><p>é€šè¿‡è‡ªå®šä¹‰ Hookï¼Œå¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚</p>
<p>åœ¨æˆ‘ä»¬å­¦ä¹ ä½¿ç”¨ Effect Hook æ—¶ï¼Œæˆ‘ä»¬å·²ç»è§è¿‡è¿™ä¸ªèŠå¤©ç¨‹åºä¸­çš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”¨äºæ˜¾ç¤ºå¥½å‹çš„åœ¨çº¿çŠ¶æ€</p>
<pre><code class="hljs plain">import React, &#123; useState, useEffect &#125; from &#39;react&#39;;

function FriendStatus(props) &#123;
  const [isOnline, setIsOnline] &#x3D; useState(null);
  useEffect(() &#x3D;&gt; &#123;
    function handleStatusChange(status) &#123;
      setIsOnline(status.isOnline);
    &#125;
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    return () &#x3D;&gt; &#123;
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    &#125;;
  &#125;);

  if (isOnline &#x3D;&#x3D;&#x3D; null) &#123;
    return &#39;Loading...&#39;;
  &#125;
  return isOnline ? &#39;Online&#39; : &#39;Offline&#39;;
&#125;</code></pre>

<p>ç°åœ¨æˆ‘ä»¬å‡è®¾èŠå¤©åº”ç”¨ä¸­æœ‰ä¸€ä¸ªè”ç³»äººåˆ—è¡¨ï¼Œå½“ç”¨æˆ·åœ¨çº¿æ—¶éœ€è¦æŠŠåå­—è®¾ç½®ä¸ºç»¿è‰²ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢ç±»ä¼¼çš„é€»è¾‘å¤åˆ¶å¹¶ç²˜è´´åˆ° FriendListItem ç»„ä»¶ä¸­æ¥ï¼Œä½†è¿™å¹¶ä¸æ˜¯ç†æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚<br>ç›¸åï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ FriendStatus å’Œ FriendListItem ä¹‹é—´å…±äº«é€»è¾‘ã€‚<br>ç›®å‰ä¸ºæ­¢ï¼Œåœ¨ React ä¸­æœ‰ä¸¤ç§æµè¡Œçš„æ–¹å¼æ¥å…±äº«ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘: render props å’Œé«˜é˜¶ç»„ä»¶ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Hook æ˜¯å¦‚ä½•åœ¨è®©ä½ ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è§£å†³ç›¸åŒé—®é¢˜çš„ã€‚</p>
<h3 id="æå–è‡ªå®šä¹‰-Hook"><a href="#æå–è‡ªå®šä¹‰-Hook" class="headerlink" title="æå–è‡ªå®šä¹‰ Hook"></a>æå–è‡ªå®šä¹‰ Hook</h3><p>å½“æˆ‘ä»¬æƒ³åœ¨ä¸¤ä¸ªå‡½æ•°ä¹‹é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠå®ƒæå–åˆ°ç¬¬ä¸‰ä¸ªå‡½æ•°ä¸­ã€‚è€Œç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·é€‚ç”¨è¿™ç§æ–¹å¼ã€‚</p>
<p><strong>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ â€œuseâ€ å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚</strong></p>
<pre><code class="hljs plain">import &#123; useState, useEffect &#125; from &#39;react&#39;;

function useFriendStatus(friendID) &#123;
  const [isOnline, setIsOnline] &#x3D; useState(null);

  useEffect(() &#x3D;&gt; &#123;
    function handleStatusChange(status) &#123;
      setIsOnline(status.isOnline);
    &#125;

    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);
    return () &#x3D;&gt; &#123;
      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);
    &#125;;
  &#125;);

  return isOnline;
&#125;</code></pre>
<p>ä¸ç»„ä»¶ä¸­ä¸€è‡´ï¼Œè¯·ç¡®ä¿åªåœ¨è‡ªå®šä¹‰ Hook çš„é¡¶å±‚æ— æ¡ä»¶åœ°è°ƒç”¨å…¶ä»– Hookã€‚</p>
<p>ä¸ React ç»„ä»¶ä¸åŒçš„æ˜¯ï¼Œè‡ªå®šä¹‰ Hook ä¸éœ€è¦å…·æœ‰ç‰¹æ®Šçš„æ ‡è¯†ã€‚æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„å†³å®šå®ƒçš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒåº”è¯¥è¿”å›ä»€ä¹ˆï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚</p>
<h3 id="ä½¿ç”¨è‡ªå®šä¹‰Hook"><a href="#ä½¿ç”¨è‡ªå®šä¹‰Hook" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰Hook"></a>ä½¿ç”¨è‡ªå®šä¹‰Hook</h3><pre><code class="hljs plain">unction FriendStatus(props) &#123;
  const isOnline &#x3D; useFriendStatus(props.friend.id);

  if (isOnline &#x3D;&#x3D;&#x3D; null) &#123;
    return &#39;Loading...&#39;;
  &#125;
  return isOnline ? &#39;Online&#39; : &#39;Offline&#39;;
&#125;</code></pre>
<pre><code class="hljs plain">function FriendListItem(props) &#123;
  const isOnline &#x3D; useFriendStatus(props.friend.id);

  return (
    &lt;li style&#x3D;&#123;&#123; color: isOnline ? &#39;green&#39; : &#39;black&#39; &#125;&#125;&gt;
      &#123;props.friend.name&#125;
    &lt;&#x2F;li&gt;
  );
&#125;</code></pre>
<p>è¿™æ®µä»£ç ç­‰ä»·äºåŸæ¥çš„ç¤ºä¾‹ä»£ç å—ï¼Ÿç­‰ä»·ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ã€‚å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬æ²¡æœ‰å¯¹å…¶è¡Œä¸ºåšä»»ä½•çš„æ”¹å˜ï¼Œæˆ‘ä»¬åªæ˜¯å°†ä¸¤ä¸ªå‡½æ•°ä¹‹é—´ä¸€äº›å…±åŒçš„ä»£ç æå–åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§è‡ªç„¶éµå¾ª Hook è®¾è®¡çš„çº¦å®šï¼Œè€Œå¹¶ä¸æ˜¯ React çš„ç‰¹æ€§ã€‚</strong></p>
<p>å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li><strong>è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ â€œuseâ€ å¼€å¤´ã€‚</strong>  ä¸éµå¾ªçš„è¯ï¼Œç”±äºæ— æ³•åˆ¤æ–­æŸä¸ªå‡½æ•°æ˜¯å¦åŒ…å«å¯¹å…¶å†…éƒ¨ Hook çš„è°ƒç”¨ï¼ŒReact å°†æ— æ³•è‡ªåŠ¨æ£€æŸ¥ä½ çš„ Hook æ˜¯å¦è¿åäº† Hook çš„è§„åˆ™ã€‚</li>
<li><strong>åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¸ä¼šå…±äº« stateã€‚</strong>  è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶(ä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼)ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨éƒ½æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚</li>
<li><strong>è‡ªå®šä¹‰ Hook å¦‚ä½•è·å–ç‹¬ç«‹çš„ state?</strong> æ¯æ¬¡è°ƒç”¨ Hookï¼Œå®ƒéƒ½ä¼šè·å–ç‹¬ç«‹çš„ stateã€‚ç”±äºæˆ‘ä»¬ç›´æ¥è°ƒç”¨äº† useFriendStatusï¼Œä» React çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬çš„ç»„ä»¶åªæ˜¯è°ƒç”¨äº† useState å’Œ useEffectã€‚ æ­£å¦‚æˆ‘ä»¬åœ¨ä¹‹å‰ç« èŠ‚ä¸­äº†è§£åˆ°çš„ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å¤šæ¬¡è°ƒç”¨ useState å’Œ useEffectï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚</li>
</ul>
<h3 id="åœ¨å¤šä¸ª-Hook-ä¹‹é—´ä¼ é€’ä¿¡æ¯"><a href="#åœ¨å¤šä¸ª-Hook-ä¹‹é—´ä¼ é€’ä¿¡æ¯" class="headerlink" title="åœ¨å¤šä¸ª Hook ä¹‹é—´ä¼ é€’ä¿¡æ¯"></a>åœ¨å¤šä¸ª Hook ä¹‹é—´ä¼ é€’ä¿¡æ¯</h3><p>ç”±äº Hook æœ¬èº«å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚</p>
<pre><code class="hljs plain">const friendList &#x3D; [
  &#123; id: 1, name: &#39;Phoebe&#39; &#125;,
  &#123; id: 2, name: &#39;Rachel&#39; &#125;,
  &#123; id: 3, name: &#39;Ross&#39; &#125;,
];

function ChatRecipientPicker() &#123;
  const [recipientID, setRecipientID] &#x3D; useState(1);
  const isRecipientOnline &#x3D; useFriendStatus(recipientID);

  return (
    &lt;&gt;
      &lt;Circle color&#x3D;&#123;isRecipientOnline ? &#39;green&#39; : &#39;red&#39;&#125; &#x2F;&gt;
      &lt;select
        value&#x3D;&#123;recipientID&#125;
        onChange&#x3D;&#123;e &#x3D;&gt; setRecipientID(Number(e.target.value))&#125;
      &gt;
        &#123;friendList.map(friend &#x3D;&gt; (
          &lt;option key&#x3D;&#123;friend.id&#125; value&#x3D;&#123;friend.id&#125;&gt;
            &#123;friend.name&#125;
          &lt;&#x2F;option&gt;
        ))&#125;
      &lt;&#x2F;select&gt;
    &lt;&#x2F;&gt;
  );
&#125;</code></pre>
<p>æˆ‘ä»¬å°†å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­ï¼Œå¹¶åœ¨ç”¨æˆ·ä» <code>&lt;select&gt;</code> ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–°è¿™ä¸ª stateã€‚</p>
<p>ç”±äº useState ä¸ºæˆ‘ä»¬æä¾›äº† recipientID çŠ¶æ€å˜é‡çš„æœ€æ–°å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™è‡ªå®šä¹‰çš„ useFriendStatus Hookã€‚<br>å¦‚æ­¤å¯ä»¥è®©æˆ‘ä»¬çŸ¥é“å½“å‰é€‰ä¸­çš„å¥½å‹æ˜¯å¦åœ¨çº¿ã€‚å½“æˆ‘ä»¬é€‰æ‹©ä¸åŒçš„å¥½å‹å¹¶æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook å°†ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€ã€‚</p>
<p>æ—¢ç„¶å‡½æ•°ç»„ä»¶èƒ½å¤Ÿåšçš„æ›´å¤šï¼Œé‚£ä¹ˆä»£ç åº“ä¸­å‡½æ•°ç»„ä»¶çš„ä»£ç è¡Œæ•°å¯èƒ½ä¼šå‰§å¢ã€‚è¿™å±äºæ­£å¸¸ç°è±¡ â€”â€” ä¸å¿…ç«‹å³å°†å®ƒä»¬æ‹†åˆ†ä¸º Hookã€‚ä½†æˆ‘ä»¬ä»é¼“åŠ±ä½ èƒ½é€šè¿‡è‡ªå®šä¹‰ Hook å¯»æ‰¾å¯èƒ½ï¼Œä»¥è¾¾åˆ°ç®€åŒ–ä»£ç é€»è¾‘ï¼Œè§£å†³ç»„ä»¶æ‚ä¹±æ— ç« çš„ç›®çš„ã€‚</p>
<h3 id="å‘æŒ¥æƒ³è±¡"><a href="#å‘æŒ¥æƒ³è±¡" class="headerlink" title="å‘æŒ¥æƒ³è±¡"></a>å‘æŒ¥æƒ³è±¡</h3><p>æœ‰ä¸ªå¤æ‚çš„ç»„ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†å¤§é‡ä»¥ç‰¹æ®Šçš„æ–¹å¼æ¥ç®¡ç†çš„å†…éƒ¨çŠ¶æ€ã€‚useState å¹¶ä¸ä¼šä½¿å¾—é›†ä¸­æ›´æ–°é€»è¾‘å˜å¾—å®¹æ˜“ï¼Œå› æ­¤ä½ å¯èƒ½æ›´æ„¿æ„ä½¿ç”¨ redux ä¸­çš„ reducer æ¥ç¼–å†™ã€‚</p>
<pre><code class="hljs plain">function todosReducer(state, action) &#123;
  switch (action.type) &#123;
    case &#39;add&#39;:
      return [...state, &#123;
        text: action.text,
        completed: false
      &#125;];
    &#x2F;&#x2F; ... other actions ...
    default:
      return state;
  &#125;
&#125;</code></pre>
<p>Reducers éå¸¸ä¾¿äºå•ç‹¬æµ‹è¯•ï¼Œä¸”æ˜“äºæ‰©å±•ï¼Œä»¥è¡¨è¾¾å¤æ‚çš„æ›´æ–°é€»è¾‘ã€‚å¦‚æœ‰å¿…è¦ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬åˆ†æˆæ›´å°çš„ reducerã€‚ä½†æ˜¯ï¼Œä½ å¯èƒ½è¿˜äº«å—ç€ React å†…éƒ¨ state å¸¦æ¥çš„å¥½å¤„ï¼Œæˆ–è€…å¯èƒ½æ ¹æœ¬ä¸æƒ³å®‰è£…å…¶ä»–åº“ã€‚</p>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç¼–å†™ä¸€ä¸ª useReducer çš„ Hookï¼Œä½¿ç”¨ reducer çš„æ–¹å¼æ¥ç®¡ç†ç»„ä»¶çš„å†…éƒ¨ state å‘¢ï¼Ÿå…¶ç®€åŒ–ç‰ˆæœ¬å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs plain">function useReducer(reducer, initialState) &#123;
  const [state, setState] &#x3D; useState(initialState);

  function dispatch(action) &#123;
    const nextState &#x3D; reducer(state, action);
    setState(nextState);
  &#125;

  return [state, dispatch];
&#125;</code></pre>

<p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å®ƒï¼Œè®© reducer é©±åŠ¨å®ƒç®¡ç† stateï¼š</p>
<pre><code class="hljs plain">function Todos() &#123;
  const [todos, dispatch] &#x3D; useReducer(todosReducer, []);

  function handleAddClick(text) &#123;
    dispatch(&#123; type: &#39;add&#39;, text &#125;);
  &#125;

  &#x2F;&#x2F; ...
&#125;</code></pre>

<p>åœ¨å¤æ‚ç»„ä»¶ä¸­ä½¿ç”¨ reducer ç®¡ç†å†…éƒ¨ state çš„éœ€æ±‚å¾ˆå¸¸è§ï¼Œæˆ‘ä»¬å·²ç»å°† useReducer çš„ Hook å†…ç½®åˆ° React ä¸­ã€‚ä½ å¯ä»¥åœ¨ <a href="https://zh-hans.reactjs.org/docs/hooks-reference.html" target="_blank" rel="noopener">Hook API ç´¢å¼•</a>ä¸­æ‰¾åˆ°å®ƒä½¿ç”¨ï¼Œæ­é…å…¶ä»–å†…ç½®çš„ Hook ä¸€èµ·ä½¿ç”¨ã€‚</p>
<h1 id="Hookçš„API"><a href="#Hookçš„API" class="headerlink" title="Hookçš„API"></a>Hookçš„API</h1><p>Hookçš„APIå¤§è‡´åˆ†ä¸ºä¸¤ç±»ã€‚</p>
<p>åŸºç¡€ Hook</p>
<ul>
<li>useState</li>
<li>useEffect</li>
<li>useContext</li>
</ul>
<p>é¢å¤–çš„ Hook</p>
<ul>
<li>useReducer</li>
<li>useCallback</li>
<li>useMemo</li>
<li>useRef</li>
<li>useImperativeHandle</li>
<li>useLayoutEffect</li>
<li>useDebugValue</li>
</ul>
<h2 id="åŸºç¡€Hook"><a href="#åŸºç¡€Hook" class="headerlink" title="åŸºç¡€Hook"></a>åŸºç¡€Hook</h2><h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><pre><code class="hljs plain">const [state, setState] &#x3D; useState(initialState);</code></pre>
<p>é™¤äº†ä¹‹å‰ä»‹ç»çš„ç”¨æ³•ã€‚</p>
<p>è¿˜å¯ä»¥è¿›è¡Œ<br><strong>å‡½æ•°å¼æ›´æ–°</strong><br>å¦‚æœæ–°çš„ state éœ€è¦é€šè¿‡ä½¿ç”¨å…ˆå‰çš„ state è®¡ç®—å¾—å‡ºï¼Œé‚£ä¹ˆå¯ä»¥å°†å‡½æ•°ä¼ é€’ç»™ setStateã€‚è¯¥å‡½æ•°å°†æ¥æ”¶å…ˆå‰çš„ stateï¼Œå¹¶è¿”å›ä¸€ä¸ªæ›´æ–°åçš„å€¼ã€‚ä¸‹é¢çš„è®¡æ•°å™¨ç»„ä»¶ç¤ºä¾‹å±•ç¤ºäº† setState çš„ä¸¤ç§ç”¨æ³•ï¼š</p>
<pre><code class="hljs plain">function Counter(&#123;initialCount&#125;) &#123;
  const [count, setCount] &#x3D; useState(initialCount);
  return (
    &lt;&gt;
      Count: &#123;count&#125;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(initialCount)&#125;&gt;Reset&lt;&#x2F;button&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(prevCount &#x3D;&gt; prevCount - 1)&#125;&gt;-&lt;&#x2F;button&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(prevCount &#x3D;&gt; prevCount + 1)&#125;&gt;+&lt;&#x2F;button&gt;
    &lt;&#x2F;&gt;
  );
&#125;</code></pre>
<p>å¦‚æœä½ çš„æ›´æ–°å‡½æ•°è¿”å›å€¼ä¸å½“å‰ state å®Œå…¨ç›¸åŒï¼Œåˆ™éšåçš„é‡æ¸²æŸ“ä¼šè¢«å®Œå…¨è·³è¿‡ã€‚</p>
<p>æ³¨æ„ï¼šä¸ class ç»„ä»¶ä¸­çš„ setState æ–¹æ³•ä¸åŒï¼ŒuseState ä¸ä¼šè‡ªåŠ¨åˆå¹¶æ›´æ–°å¯¹è±¡ã€‚ä½ å¯ä»¥ç”¨å‡½æ•°å¼çš„ setState ç»“åˆå±•å¼€è¿ç®—ç¬¦æ¥è¾¾åˆ°åˆå¹¶æ›´æ–°å¯¹è±¡çš„æ•ˆæœã€‚<br>useReducer æ˜¯å¦ä¸€ç§å¯é€‰æ–¹æ¡ˆï¼Œå®ƒæ›´é€‚åˆç”¨äºç®¡ç†åŒ…å«å¤šä¸ªå­å€¼çš„ state å¯¹è±¡ã€‚</p>
<p><strong>æƒ°æ€§åˆå§‹state</strong><br>initialState å‚æ•°åªä¼šåœ¨ç»„ä»¶çš„åˆå§‹æ¸²æŸ“ä¸­èµ·ä½œç”¨ï¼Œåç»­æ¸²æŸ“æ—¶ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœåˆå§‹ state éœ€è¦é€šè¿‡å¤æ‚è®¡ç®—è·å¾—ï¼Œåˆ™å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­è®¡ç®—å¹¶è¿”å›åˆå§‹çš„ stateï¼Œæ­¤å‡½æ•°åªåœ¨åˆå§‹æ¸²æŸ“æ—¶è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs plain">const [state, setState] &#x3D; useState(() &#x3D;&gt; &#123;
  const initialState &#x3D; someExpensiveComputation(props);
  return initialState;
&#125;);</code></pre>

<p><strong>è·³è¿‡stateæ›´æ–°</strong><br>è°ƒç”¨ State Hook çš„æ›´æ–°å‡½æ•°å¹¶ä¼ å…¥å½“å‰çš„ state æ—¶ï¼ŒReact å°†è·³è¿‡å­ç»„ä»¶çš„æ¸²æŸ“åŠ effect çš„æ‰§è¡Œã€‚ï¼ˆReact ä½¿ç”¨ Object.is æ¯”è¾ƒç®—æ³• æ¥æ¯”è¾ƒ stateã€‚ï¼‰</p>
<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><pre><code class="hljs plain">useEffect(didUpdate);</code></pre>
<p>ä½¿ç”¨ useEffect å®Œæˆå‰¯ä½œç”¨æ“ä½œã€‚èµ‹å€¼ç»™ useEffect çš„å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“åˆ°å±å¹•ä¹‹åæ‰§è¡Œã€‚ä½ å¯ä»¥æŠŠ effect çœ‹ä½œä» React çš„çº¯å‡½æ•°å¼ä¸–ç•Œé€šå¾€å‘½ä»¤å¼ä¸–ç•Œçš„é€ƒç”Ÿé€šé“ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œeffect å°†åœ¨æ¯è½®æ¸²æŸ“ç»“æŸåæ‰§è¡Œã€‚å‰é¢è¯´åˆ°è¿‡ï¼Œä½†ä½ å¯ä»¥é€‰æ‹©è®©å®ƒ åœ¨åªæœ‰æŸäº›å€¼æ”¹å˜çš„æ—¶å€™ æ‰æ‰§è¡Œã€‚</p>
<p>ä¸ componentDidMountã€componentDidUpdate ä¸åŒçš„æ˜¯ï¼Œåœ¨æµè§ˆå™¨å®Œæˆå¸ƒå±€ä¸ç»˜åˆ¶ä¹‹åï¼Œä¼ ç»™ useEffect çš„å‡½æ•°ä¼šå»¶è¿Ÿè°ƒç”¨ã€‚è¿™ä½¿å¾—å®ƒé€‚ç”¨äºè®¸å¤šå¸¸è§çš„å‰¯ä½œç”¨åœºæ™¯ï¼Œæ¯”å¦‚è®¾ç½®è®¢é˜…å’Œäº‹ä»¶å¤„ç†ç­‰æƒ…å†µï¼Œå› æ­¤ä¸åº”åœ¨å‡½æ•°ä¸­æ‰§è¡Œé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•çš„æ“ä½œã€‚</p>
<p>ç„¶è€Œï¼Œå¹¶éæ‰€æœ‰ effect éƒ½å¯ä»¥è¢«å»¶è¿Ÿæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨æµè§ˆå™¨æ‰§è¡Œä¸‹ä¸€æ¬¡ç»˜åˆ¶å‰ï¼Œç”¨æˆ·å¯è§çš„ DOM å˜æ›´å°±å¿…é¡»åŒæ­¥æ‰§è¡Œï¼Œè¿™æ ·ç”¨æˆ·æ‰ä¸ä¼šæ„Ÿè§‰åˆ°è§†è§‰ä¸Šçš„ä¸ä¸€è‡´ã€‚ï¼ˆæ¦‚å¿µä¸Šç±»ä¼¼äºè¢«åŠ¨ç›‘å¬äº‹ä»¶å’Œä¸»åŠ¨ç›‘å¬äº‹ä»¶çš„åŒºåˆ«ã€‚ï¼‰React ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªé¢å¤–çš„ <strong>useLayoutEffect Hook</strong> æ¥å¤„ç†è¿™ç±» effectã€‚å®ƒå’Œ useEffect çš„ç»“æ„ç›¸åŒï¼ŒåŒºåˆ«åªæ˜¯è°ƒç”¨æ—¶æœºä¸åŒã€‚</p>
<p>è™½ç„¶ useEffect ä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åå»¶è¿Ÿæ‰§è¡Œï¼Œä½†ä¼šä¿è¯åœ¨ä»»ä½•æ–°çš„æ¸²æŸ“å‰æ‰§è¡Œã€‚React å°†åœ¨ç»„ä»¶æ›´æ–°å‰åˆ·æ–°ä¸Šä¸€è½®æ¸²æŸ“çš„ effectã€‚</p>
<p><strong>effect çš„æ¡ä»¶æ‰§è¡Œ</strong><br>å³å‰é¢è¯´åˆ°çš„ç¬¬äºŒä¸ªå‚æ•°,å®ƒæ˜¯ effect æ‰€ä¾èµ–çš„å€¼æ•°ç»„ã€‚æ›´æ–°åçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs plain">useEffect(
  () &#x3D;&gt; &#123;
    const subscription &#x3D; props.source.subscribe();
    return () &#x3D;&gt; &#123;
      subscription.unsubscribe();
    &#125;;
  &#125;,
  [props.source],
);</code></pre>
<p>æ­¤æ—¶ï¼Œåªæœ‰å½“ props.source æ”¹å˜åæ‰ä¼šé‡æ–°åˆ›å»ºè®¢é˜…ã€‚</p>
<p>å†æ¬¡å¼ºè°ƒï¼Œ<strong>è¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šå‘ç”Ÿå˜åŒ–ä¸”åœ¨ effect ä¸­ä½¿ç”¨çš„å˜é‡</strong>ã€‚ è§<a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">å¦‚ä½•å¤„ç†å‡½æ•°</a>å’Œ<a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#what-can-i-do-if-my-effect-dependencies-change-too-often" target="_blank" rel="noopener">æ•°ç»„é¢‘ç¹å˜åŒ–æ—¶çš„æªæ–½</a></p>
<p>è¿™é‡Œç¡®å®æœ‰ä¸€ç‚¹éº»çƒ¦ï¼Œéœ€è¦è‡ªå·±ä¼ å…¥å¯¹åº”çš„propï¼Œstateæˆ–äºŒè€…çš„è¡ç”Ÿå€¼æ‰èƒ½å®Œæˆä¼˜åŒ–ã€‚æœªæ¥ç¼–è¯‘å™¨ä¼šæ›´åŠ æ™ºèƒ½ï¼Œå±Šæ—¶è‡ªåŠ¨åˆ›å»ºæ•°ç»„å°†æˆä¸ºå¯èƒ½ã€‚</p>
<p>å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚ä½†è¿™éœ€è¦ä½ çš„effectå‡½æ•°ç¡®å®æ²¡æœ‰å¼•ç”¨ propsã€state ä»¥åŠç”±å®ƒä»¬è¡ç”Ÿè€Œæ¥çš„å€¼ã€‚</p>
<h3 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h3><pre><code class="hljs plain">const value &#x3D; useContext(MyContext);</code></pre>
<p>æ¥æ”¶ä¸€ä¸ª context å¯¹è±¡ï¼ˆReact.createContext çš„è¿”å›å€¼ï¼‰å¹¶è¿”å›è¯¥ context çš„å½“å‰å€¼ã€‚å½“å‰çš„ context å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„ <code>&lt;MyContext.Provider&gt;</code> çš„ value prop å†³å®šã€‚<br>å½“ç»„ä»¶ä¸Šå±‚æœ€è¿‘çš„ <code>&lt;MyContext.Provider&gt;</code>æ›´æ–°æ—¶ï¼Œè¯¥ Hook ä¼šè§¦å‘é‡æ¸²æŸ“.å³ä½¿ç¥–å…ˆä½¿ç”¨ React.memo æˆ– shouldComponentUpdateï¼Œä¹Ÿä¼šåœ¨ç»„ä»¶æœ¬èº«ä½¿ç”¨ useContext æ—¶é‡æ–°æ¸²æŸ“ã€‚</p>
<p>åˆ«å¿˜è®° useContext çš„å‚æ•°å¿…é¡»æ˜¯ context å¯¹è±¡æœ¬èº«ï¼š</p>
<ul>
<li>æ­£ç¡®ï¼š useContext(MyContext)</li>
<li>é”™è¯¯ï¼š useContext(MyContext.Consumer)</li>
<li>é”™è¯¯ï¼š useContext(MyContext.Provider)</li>
</ul>
<p>è°ƒç”¨äº† useContext çš„ç»„ä»¶æ€»ä¼šåœ¨ context å€¼å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ã€‚å¦‚æœé‡æ¸²æŸ“ç»„ä»¶çš„å¼€é”€è¾ƒå¤§ï¼Œä½ å¯ä»¥ <a href="https://github.com/facebook/react/issues/15156#issuecomment-474590693" target="_blank" rel="noopener">é€šè¿‡ä½¿ç”¨ memoization æ¥ä¼˜åŒ–</a>ã€‚</p>
<p>æ³¨æ„ï¼š<br>useContext(MyContext) ç›¸å½“äº class ç»„ä»¶ä¸­çš„ static contextType = MyContext æˆ–è€… <code>&lt;MyContext.Consumer&gt;</code>ã€‚<br>useContext(MyContext) åªæ˜¯è®©ä½ èƒ½å¤Ÿè¯»å– context çš„å€¼ä»¥åŠè®¢é˜… context çš„å˜åŒ–ã€‚ä½ ä»ç„¶éœ€è¦åœ¨ä¸Šå±‚ç»„ä»¶æ ‘ä¸­ä½¿ç”¨ <code>&lt;MyContext.Provider&gt;</code> æ¥ä¸ºä¸‹å±‚ç»„ä»¶æä¾› contextã€‚</p>
<h2 id="é¢å¤–çš„Hook"><a href="#é¢å¤–çš„Hook" class="headerlink" title="é¢å¤–çš„Hook"></a>é¢å¤–çš„Hook</h2><p>ä»¥ä¸‹ä»‹ç»çš„ Hookï¼Œæœ‰äº›æ˜¯ä¸Šä¸€èŠ‚ä¸­åŸºç¡€ Hook çš„å˜ä½“ï¼Œæœ‰äº›åˆ™ä»…åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¼šç”¨åˆ°ã€‚</p>
<h3 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h3><pre><code class="hljs plain">const [state, dispatch] &#x3D; useReducer(reducer, initialArg, init);</code></pre>
<p>useState çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå½¢å¦‚ (state, action) =&gt; newState çš„ reducerï¼Œå¹¶è¿”å›å½“å‰çš„ state ä»¥åŠä¸å…¶é…å¥—çš„ dispatch æ–¹æ³•ã€‚ï¼ˆå¦‚æœä½ ç†Ÿæ‚‰ Redux çš„è¯ï¼Œå°±å·²ç»çŸ¥é“å®ƒå¦‚ä½•å·¥ä½œäº†ã€‚ï¼‰<br>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒuseReducer ä¼šæ¯” useState æ›´é€‚ç”¨ï¼Œä¾‹å¦‚ state é€»è¾‘è¾ƒå¤æ‚ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ª state ä¾èµ–äºä¹‹å‰çš„ state ç­‰ã€‚å¹¶ä¸”ï¼Œä½¿ç”¨ useReducer è¿˜èƒ½ç»™é‚£äº›ä¼šè§¦å‘æ·±æ›´æ–°çš„ç»„ä»¶åšæ€§èƒ½ä¼˜åŒ–ï¼Œå› ä¸ºä½ å¯ä»¥å‘å­ç»„ä»¶ä¼ é€’ dispatch è€Œä¸æ˜¯å›è°ƒå‡½æ•° ã€‚</p>
<pre><code class="hljs plain">const initialState &#x3D; &#123;count: 0&#125;;

&#x2F;&#x2F;reducerä¸ºå•ç‹¬å®šä¹‰çš„å‡½æ•°
function reducer(state, action) &#123;
  switch (action.type) &#123;
    case &#39;increment&#39;:
      &#x2F;&#x2F;æ³¨æ„è¿™é‡Œï¼Œä¸ç”¨è¿”å›dispathï¼Œreactä¼šå¸®æˆ‘ä»¬å®ç°ï¼Œè·ŸreduxåŸºæœ¬ä¸€è‡´
      return &#123;count: state.count + 1&#125;;
    case &#39;decrement&#39;:
      return &#123;count: state.count - 1&#125;;
    default:
      throw new Error();
  &#125;
&#125;

function Counter() &#123;
  const [state, dispatch] &#x3D; useReducer(reducer, initialState);
  return (
    &lt;&gt;
      Count: &#123;state.count&#125;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;decrement&#39;&#125;)&#125;&gt;-&lt;&#x2F;button&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;increment&#39;&#125;)&#125;&gt;+&lt;&#x2F;button&gt;
    &lt;&#x2F;&gt;
  );
&#125;</code></pre>
<p>React ä¼šç¡®ä¿ dispatch å‡½æ•°çš„æ ‡è¯†æ˜¯ç¨³å®šçš„ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥å®‰å…¨åœ°ä» useEffect æˆ– useCallback çš„ä¾èµ–åˆ—è¡¨ä¸­çœç•¥ dispatchã€‚</p>
<p><strong>æƒ°æ€§åˆå§‹åŒ–</strong><br>æ³¨æ„åˆ°useReducerçš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚ç”¨äºè®©æˆ‘ä»¬å¯ä»¥é€‰æ‹© æƒ°æ€§åœ°åˆ›å»ºåˆå§‹ stateã€‚ä¸ºæ­¤ï¼Œéœ€è¦å°† init å‡½æ•°ä½œä¸º useReducer çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ï¼Œè¿™æ ·åˆå§‹ state å°†è¢«è®¾ç½®ä¸º init(initialArg)ã€‚<br>è¿™ä¹ˆåšå¯ä»¥å°†ç”¨äºè®¡ç®— state çš„é€»è¾‘æå–åˆ° reducer å¤–éƒ¨ï¼Œè¿™ä¹Ÿä¸ºå°†æ¥å¯¹é‡ç½® state çš„ action åšå¤„ç†æä¾›äº†ä¾¿åˆ©ï¼š</p>
<pre><code class="hljs plain">function init(initialCount) &#123;
  return &#123;count: initialCount&#125;;
&#125;

function reducer(state, action) &#123;
  switch (action.type) &#123;
    case &#39;increment&#39;:
      return &#123;count: state.count + 1&#125;;
    case &#39;decrement&#39;:
      return &#123;count: state.count - 1&#125;;
    case &#39;reset&#39;:
      return init(action.payload);
    default:
      throw new Error();
  &#125;
&#125;

function Counter(&#123;initialCount&#125;) &#123;
  const [state, dispatch] &#x3D; useReducer(reducer, initialCount, init);
  return (
    &lt;&gt;
      Count: &#123;state.count&#125;
      &lt;button
        onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;reset&#39;, payload: initialCount&#125;)&#125;&gt;
        Reset
      &lt;&#x2F;button&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;decrement&#39;&#125;)&#125;&gt;-&lt;&#x2F;button&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123;type: &#39;increment&#39;&#125;)&#125;&gt;+&lt;&#x2F;button&gt;
    &lt;&#x2F;&gt;
  );
&#125;</code></pre>
<p>å¦‚æœ Reducer Hook çš„è¿”å›å€¼ä¸å½“å‰ state ç›¸åŒï¼ŒReact å°†è·³è¿‡å­ç»„ä»¶çš„æ¸²æŸ“åŠå‰¯ä½œç”¨çš„æ‰§è¡Œã€‚ï¼ˆReact ä½¿ç”¨ Object.is æ¯”è¾ƒç®—æ³• æ¥æ¯”è¾ƒ stateã€‚ï¼‰</p>
<h3 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h3><pre><code class="hljs plain">const memoizedCallback &#x3D; useCallback(
  () &#x3D;&gt; &#123;
    doSomething(a, b);
  &#125;,
  [a, b],
);</code></pre>
<p>è¿”å›ä¸€ä¸ª memoized å›è°ƒå‡½æ•°ã€‚<br>æŠŠå†…è”å›è°ƒå‡½æ•°åŠä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ useCallbackï¼Œå®ƒå°†è¿”å›è¯¥å›è°ƒå‡½æ•°çš„ memoized ç‰ˆæœ¬ï¼Œè¯¥å›è°ƒå‡½æ•°ä»…åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°ã€‚å½“ä½ æŠŠå›è°ƒå‡½æ•°ä¼ é€’ç»™ç»è¿‡ä¼˜åŒ–çš„å¹¶ä½¿ç”¨å¼•ç”¨ç›¸ç­‰æ€§å»é¿å…éå¿…è¦æ¸²æŸ“ï¼ˆä¾‹å¦‚ shouldComponentUpdateï¼‰çš„å­ç»„ä»¶æ—¶ï¼Œå®ƒå°†éå¸¸æœ‰ç”¨ã€‚<br>useCallback(fn, deps) ç›¸å½“äº useMemo(() =&gt; fn, deps)ã€‚</p>
<h3 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h3><pre><code class="hljs plain">const memoizedValue &#x3D; useMemo(() &#x3D;&gt; computeExpensiveValue(a, b), [a, b]);</code></pre>
<p>è¿”å›ä¸€ä¸ª memoized å€¼ã€‚</p>
<p>æŠŠâ€œåˆ›å»ºâ€å‡½æ•°å’Œä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ useMemoï¼Œå®ƒä»…ä¼šåœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰é‡æ–°è®¡ç®— memoized å€¼ã€‚è¿™ç§ä¼˜åŒ–æœ‰åŠ©äºé¿å…åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—ã€‚</p>
<p>è®°ä½ï¼Œä¼ å…¥ useMemo çš„å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œã€‚è¯·ä¸è¦åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œä¸æ¸²æŸ“æ— å…³çš„æ“ä½œï¼Œè¯¸å¦‚å‰¯ä½œç”¨è¿™ç±»çš„æ“ä½œå±äº useEffect çš„é€‚ç”¨èŒƒç•´ï¼Œè€Œä¸æ˜¯ useMemoã€‚</p>
<p>å¦‚æœæ²¡æœ‰æä¾›ä¾èµ–é¡¹æ•°ç»„ï¼ŒuseMemo åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè®¡ç®—æ–°çš„å€¼ã€‚</p>
<p>ä½ å¯ä»¥æŠŠ useMemo ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µï¼Œä½†ä¸è¦æŠŠå®ƒå½“æˆè¯­ä¹‰ä¸Šçš„ä¿è¯ã€‚</p>
<h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><pre><code class="hljs plain">const refContainer &#x3D; useRef(initialValue);</code></pre>

<h3 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h3><h3 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a>useLayoutEffect</h3><p>å…¶å‡½æ•°ç­¾åä¸ useEffect ç›¸åŒï¼Œä½†å®ƒä¼šåœ¨æ‰€æœ‰çš„ DOM å˜æ›´ä¹‹ååŒæ­¥è°ƒç”¨ effectã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å– DOM å¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼ŒuseLayoutEffect å†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°ã€‚</p>
<p>å°½å¯èƒ½ä½¿ç”¨æ ‡å‡†çš„ useEffect ä»¥é¿å…é˜»å¡è§†è§‰æ›´æ–°ã€‚</p>
<p>æˆ‘ä»¬æ¨èä½ ä¸€å¼€å§‹å…ˆç”¨ useEffectï¼Œåªæœ‰å½“å®ƒå‡ºé—®é¢˜çš„æ—¶å€™å†å°è¯•ä½¿ç”¨ useLayoutEffectã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Œè¯·è®°ä½ï¼Œæ— è®º useLayoutEffect è¿˜æ˜¯ useEffect éƒ½æ— æ³•åœ¨ Javascript ä»£ç åŠ è½½å®Œæˆä¹‹å‰æ‰§è¡Œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨æœåŠ¡ç«¯æ¸²æŸ“ç»„ä»¶ä¸­å¼•å…¥ useLayoutEffect ä»£ç æ—¶ä¼šè§¦å‘ React å‘Šè­¦ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å°†ä»£ç é€»è¾‘ç§»è‡³ useEffect ä¸­ï¼ˆå¦‚æœé¦–æ¬¡æ¸²æŸ“ä¸éœ€è¦è¿™æ®µé€»è¾‘çš„æƒ…å†µä¸‹ï¼‰ï¼Œæˆ–æ˜¯å°†è¯¥ç»„ä»¶å»¶è¿Ÿåˆ°å®¢æˆ·ç«¯æ¸²æŸ“å®Œæˆåå†æ˜¾ç¤ºï¼ˆå¦‚æœç›´åˆ° useLayoutEffect æ‰§è¡Œä¹‹å‰ HTML éƒ½æ˜¾ç¤ºé”™ä¹±çš„æƒ…å†µä¸‹ï¼‰ã€‚</p>
<p>è‹¥è¦ä»æœåŠ¡ç«¯æ¸²æŸ“çš„ HTML ä¸­æ’é™¤ä¾èµ–å¸ƒå±€ effect çš„ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ showChild &amp;&amp; <code>&lt;Child /&gt;</code> è¿›è¡Œæ¡ä»¶æ¸²æŸ“ï¼Œå¹¶ä½¿ç”¨ useEffect(() =&gt; { setShowChild(true); }, []) å»¶è¿Ÿå±•ç¤ºç»„ä»¶ã€‚è¿™æ ·ï¼Œåœ¨å®¢æˆ·ç«¯æ¸²æŸ“å®Œæˆä¹‹å‰ï¼ŒUI å°±ä¸ä¼šåƒä¹‹å‰é‚£æ ·æ˜¾ç¤ºé”™ä¹±äº†ã€‚</p>
<h3 id="useDebugValue"><a href="#useDebugValue" class="headerlink" title="useDebugValue"></a>useDebugValue</h3>
            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/web%E5%89%8D%E7%AB%AF/">webå‰ç«¯</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/React/">React</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%9F%BA%E7%A1%80/">åŸºç¡€</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/05/28/React%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9F%A5%E8%AF%86%E7%82%B9-%E8%BF%9B%E9%98%B6/">
                        <span class="hidden-mobile">Reactå®˜æ–¹æ–‡æ¡£çŸ¥è¯†ç‚¹-è¿›é˜¶</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
              <!-- Comments -->
              <div class="comments" id="comments">
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://toulondu.github.io/2020/05/28/Reactå®˜æ–¹æ–‡æ¡£çŸ¥è¯†ç‚¹-Contextå’ŒHook/';
        this.page.identifier = '/2020/05/28/Reactå®˜æ–¹æ–‡æ¡£çŸ¥è¯†ç‚¹-Contextå’ŒHook/';
      };
      var oldLoadDq = window.onload;
      window.onload = function () {
        oldLoadDq && oldLoadDq();

        var d = document, s = d.createElement('script');
        s.type = 'text/javascript';
        s.src = '//' + 'Toulon' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      };
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener noopener">comments
        powered by Disqus.</a></noscript>
  </div>


              </div>
            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>






<!-- Plugins -->



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Reactå®˜æ–¹æ–‡æ¡£çŸ¥è¯†ç‚¹-Contextå’ŒHook&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>


















</body>
</html>
